<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Debug - Troubleshooting</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* MINIMAL CRITICAL STYLES ONLY */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .debug-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 20px auto;
            max-width: 1200px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .cart-item {
            border: 2px solid #007bff;
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .product-image {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin-right: 15px;
        }
        
        .product-image.organic {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
        
        .product-image.premium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #22c55e;
        }
        
        .quantity-btn {
            width: 35px;
            height: 35px;
            border: 2px solid #22c55e;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #22c55e;
            font-weight: bold;
        }
        
        .quantity-btn:hover {
            background: #22c55e;
            color: white;
        }
        
        .quantity-input {
            border: 2px solid #22c55e;
            background: white;
            border-radius: 5px;
            width: 60px;
            height: 35px;
            text-align: center;
            font-weight: bold;
            outline: none;
        }
        
        .price-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #22c55e;
        }
        
        #cartItems {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .emergency-override {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9999;
            background: #dc3545 !important;
        }
        
        .status-indicator {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .status-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üêõ Cart Display Troubleshooting</h1>
        
        <!-- EMERGENCY CONTROLS -->
        <div class="row mb-4">
            <div class="col-12">
                <button class="btn btn-danger emergency-override" onclick="emergencyFix()">
                    üö® EMERGENCY FIX
                </button>
                <button class="btn btn-warning me-2" onclick="fullDebug()">
                    üîç FULL DEBUG
                </button>
                <button class="btn btn-success me-2" onclick="forceLoad()">
                    üîÑ FORCE LOAD
                </button>
                <button class="btn btn-info me-2" onclick="clearEverything()">
                    üßπ CLEAR ALL
                </button>
                <button class="btn btn-secondary" onclick="testBasicDisplay()">
                    üß™ TEST DISPLAY
                </button>
            </div>
        </div>
        
        <!-- STATUS INDICATORS -->
        <div id="statusIndicators">
            <div class="status-indicator status-warning">
                ‚è≥ Initializing troubleshooting...
            </div>
        </div>
        
        <!-- DEBUG INFO -->
        <div id="debugInfo" class="debug-info">
            <strong>Debug Log:</strong><br>
            <span id="debugLog">Starting debug session...</span>
        </div>
        
        <!-- CART ITEMS CONTAINER -->
        <div class="row">
            <div class="col-12">
                <h3>üõí Cart Items Display Test</h3>
                <div id="itemCount" class="mb-3">
                    <strong>Item Count:</strong> <span id="countDisplay">Loading...</span>
                </div>
                
                <!-- THIS IS THE CRITICAL CONTAINER -->
                <div id="cartItems" style="display: block !important; visibility: visible !important; opacity: 1 !important; min-height: 100px; border: 3px solid #007bff; padding: 20px; background: white;">
                    <div class="text-center py-4" id="loadingIndicator">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <div>Loading cart items...</div>
                    </div>
                </div>
                
                <!-- EMPTY CART MESSAGE -->
                <div id="emptyCart" style="display: none;">
                    <div class="text-center py-4">
                        <i class="fas fa-shopping-cart fa-3x mb-3 text-muted"></i>
                        <h4>Your cart is empty</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // GLOBAL DEBUG VARIABLES
        let cartItems = [];
        let debugLog = [];
        
        function log(message) {
            console.log(message);
            debugLog.push(new Date().toLocaleTimeString() + ': ' + message);
            updateDebugDisplay();
        }
        
        function updateDebugDisplay() {
            document.getElementById('debugLog').innerHTML = debugLog.slice(-10).join('<br>');
        }
        
        function updateStatus(message, type = 'warning') {
            const statusDiv = document.getElementById('statusIndicators');
            statusDiv.innerHTML = `<div class="status-indicator status-${type}">${message}</div>`;
        }
        
        // CRITICAL: Try to load existing cart data
        function loadCartData() {
            log('üîÑ Attempting to load cart data...');
            
            try {
                const stored = localStorage.getItem('ohsCart');
                if (stored) {
                    cartItems = JSON.parse(stored);
                    log(`‚úÖ Loaded ${cartItems.length} items from localStorage`);
                } else {
                    log('‚ö†Ô∏è No cart data in localStorage');
                    cartItems = [];
                }
            } catch (error) {
                log(`‚ùå Error loading cart: ${error.message}`);
                cartItems = [];
            }
            
            // If no items, create test data
            if (cartItems.length === 0) {
                log('üß™ Creating test data...');
                createTestData();
            }
            
            displayCartItems();
        }
        
        function createTestData() {
            cartItems = [
                {
                    productId: 'debug_test_1',
                    name: 'DEBUG: Organic Multi-Surface Cleaner',
                    price: 21.80,
                    quantity: 5,
                    type: 'organic',
                    description: 'This is a test item for debugging display issues',
                    emoji: 'üß¥',
                    size: '32oz',
                    sku: 'DEBUG-001'
                },
                {
                    productId: 'debug_test_2', 
                    name: 'DEBUG: Premium Disinfectant',
                    price: 16.13,
                    quantity: 10,
                    type: 'premium',
                    description: 'Another test item to verify cart display',
                    emoji: 'üè≠',
                    size: '32oz',
                    sku: 'DEBUG-002'
                },
                {
                    productId: 'debug_test_3',
                    name: 'DEBUG: Test Product #3',
                    price: 24.99,
                    quantity: 2,
                    type: 'organic',
                    description: 'Third test item for comprehensive testing',
                    emoji: 'üßΩ',
                    size: '1 Gallon',
                    sku: 'DEBUG-003'
                }
            ];
            
            // Save to localStorage
            try {
                localStorage.setItem('ohsCart', JSON.stringify(cartItems));
                log(`üíæ Saved ${cartItems.length} test items to localStorage`);
            } catch (error) {
                log(`‚ùå Error saving test data: ${error.message}`);
            }
        }
        
        // CRITICAL: Display cart items with maximum debugging
        function displayCartItems() {
            log(`üéØ Starting display process for ${cartItems.length} items`);
            
            const container = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            const countDisplay = document.getElementById('countDisplay');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            // Update count
            if (countDisplay) {
                countDisplay.textContent = `${cartItems.length} items in cart`;
            }
            
            // Remove loading indicator
            if (loadingIndicator) {
                loadingIndicator.remove();
            }
            
            if (!container) {
                log('‚ùå CRITICAL: cartItems container not found!');
                updateStatus('‚ùå CRITICAL ERROR: Cart container missing!', 'error');
                return;
            }
            
            log('‚úÖ Container found, checking items...');
            
            if (cartItems.length === 0) {
                log('üìÑ No items to display, showing empty state');
                container.style.display = 'none';
                if (emptyCart) emptyCart.style.display = 'block';
                updateStatus('üìÑ Cart is empty', 'warning');
                return;
            }
            
            // FORCE CONTAINER VISIBILITY
            container.style.cssText = `
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                min-height: 100px !important;
                border: 3px solid #007bff !important;
                padding: 20px !important;
                background: white !important;
            `;
            
            if (emptyCart) emptyCart.style.display = 'none';
            
            log(`üèóÔ∏è Building HTML for ${cartItems.length} items...`);
            
            let html = '';
            cartItems.forEach((item, index) => {
                const productType = item.type || 'organic';
                const isOrganic = productType === 'organic';
                
                log(`  üì¶ Processing item ${index + 1}: ${item.name}`);
                
                html += `
                    <div class="cart-item" data-index="${index}" style="display: block !important; visibility: visible !important; opacity: 1 !important; margin-bottom: 20px !important;">
                        <div class="row align-items-center">
                            <div class="col-md-2 col-3">
                                <div class="product-image ${isOrganic ? 'organic' : 'premium'}">
                                    ${item.emoji || (isOrganic ? 'üå±' : 'üëë')}
                                </div>
                            </div>
                            <div class="col-md-4 col-9">
                                <h6 class="fw-bold mb-2">${item.name}</h6>
                                <p class="text-muted small mb-2">${item.description}</p>
                                <div class="mb-2">
                                    <span class="badge ${isOrganic ? 'bg-success' : 'bg-warning'}">
                                        ${isOrganic ? 'USDA Organic' : 'EPA Premium'}
                                    </span>
                                    ${item.size ? `<span class="badge bg-secondary ms-1">${item.size}</span>` : ''}
                                    ${item.sku ? `<span class="badge bg-info ms-1">${item.sku}</span>` : ''}
                                </div>
                            </div>
                            <div class="col-md-3 col-12 mb-3">
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="changeQuantity(${index}, -1)" ${item.quantity <= 1 ? 'disabled' : ''}>
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="999" onchange="setQuantity(${index}, this.value)">
                                    <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="price-display">$${item.price.toFixed(2)}</div>
                                <small class="text-muted">each</small>
                            </div>
                            <div class="col-md-1 col-6 text-center">
                                <div class="price-display mb-2">$${(item.price * item.quantity).toFixed(2)}</div>
                                <button class="btn btn-sm btn-outline-danger" onclick="removeItem(${index})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            log(`üìù Generated HTML length: ${html.length} characters`);
            
            // SET THE HTML
            container.innerHTML = html;
            
            // FORCE REFLOW
            container.offsetHeight;
            
            log('‚úÖ HTML set, checking final state...');
            log(`   Container display: ${container.style.display}`);
            log(`   Container visibility: ${container.style.visibility}`);
            log(`   Container opacity: ${container.style.opacity}`);
            log(`   Container innerHTML length: ${container.innerHTML.length}`);
            
            // Final verification
            setTimeout(() => {
                const computedStyle = window.getComputedStyle(container);
                log(`   Computed display: ${computedStyle.display}`);
                log(`   Computed visibility: ${computedStyle.visibility}`);
                log(`   Computed opacity: ${computedStyle.opacity}`);
                
                if (container.innerHTML.length > 100) {
                    updateStatus(`‚úÖ SUCCESS: ${cartItems.length} items displayed successfully!`, 'success');
                } else {
                    updateStatus('‚ùå ERROR: Items not displaying properly', 'error');
                }
            }, 100);
        }
        
        // EMERGENCY FUNCTIONS
        function emergencyFix() {
            log('üö® EMERGENCY FIX ACTIVATED');
            
            const container = document.getElementById('cartItems');
            if (container) {
                // Nuclear option - completely rebuild container
                container.remove();
                
                const newContainer = document.createElement('div');
                newContainer.id = 'cartItems';
                newContainer.style.cssText = `
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    min-height: 200px !important;
                    border: 5px solid red !important;
                    padding: 30px !important;
                    background: yellow !important;
                    font-size: 18px !important;
                    color: black !important;
                `;
                
                // Find parent and insert
                const parent = document.querySelector('.col-12');
                parent.appendChild(newContainer);
                
                // Add emergency content
                newContainer.innerHTML = `
                    <h2 style="color: red !important;">üö® EMERGENCY MODE ACTIVATED</h2>
                    <p><strong>Cart Items Found:</strong> ${cartItems.length}</p>
                    <div style="background: white; padding: 20px; margin: 10px 0; border: 2px solid blue;">
                        ${cartItems.map((item, i) => `
                            <div style="padding: 10px; margin: 5px 0; background: lightgray; border: 1px solid black;">
                                <strong>${i + 1}. ${item.name}</strong><br>
                                Price: $${item.price} | Qty: ${item.quantity} | Type: ${item.type}
                            </div>
                        `).join('')}
                    </div>
                `;
                
                log('üö® Emergency container created and populated');
                updateStatus('üö® EMERGENCY MODE: Items force-displayed', 'error');
            }
        }
        
        function fullDebug() {
            log('üîç FULL DEBUG SCAN');
            log(`   Cart items array: ${JSON.stringify(cartItems, null, 2)}`);
            log(`   LocalStorage: ${localStorage.getItem('ohsCart')}`);
            
            const container = document.getElementById('cartItems');
            if (container) {
                log(`   Container exists: true`);
                log(`   Container tagName: ${container.tagName}`);
                log(`   Container innerHTML: ${container.innerHTML.substring(0, 200)}...`);
            } else {
                log(`   Container exists: false`);
            }
        }
        
        function forceLoad() {
            log('üîÑ FORCE RELOAD');
            loadCartData();
        }
        
        function clearEverything() {
            log('üßπ CLEARING EVERYTHING');
            cartItems = [];
            localStorage.removeItem('ohsCart');
            const container = document.getElementById('cartItems');
            if (container) {
                container.innerHTML = '<div class="text-center py-4"><h4>Cart Cleared</h4></div>';
            }
            updateStatus('üßπ Everything cleared', 'warning');
        }
        
        function testBasicDisplay() {
            log('üß™ TESTING BASIC DISPLAY');
            const container = document.getElementById('cartItems');
            if (container) {
                container.innerHTML = `
                    <div style="background: green; color: white; padding: 20px; margin: 10px; font-size: 18px;">
                        ‚úÖ BASIC DISPLAY TEST SUCCESSFUL
                        <br>This text proves the container can display content.
                        <br>Current time: ${new Date().toLocaleTimeString()}
                    </div>
                `;
                updateStatus('üß™ Basic display test completed', 'success');
            }
        }
        
        // CART MANIPULATION FUNCTIONS
        function changeQuantity(index, change) {
            if (cartItems[index]) {
                cartItems[index].quantity += change;
                if (cartItems[index].quantity <= 0) {
                    cartItems.splice(index, 1);
                }
                localStorage.setItem('ohsCart', JSON.stringify(cartItems));
                displayCartItems();
                log(`üîÑ Quantity changed for item ${index}`);
            }
        }
        
        function setQuantity(index, value) {
            if (cartItems[index]) {
                cartItems[index].quantity = Math.max(1, parseInt(value) || 1);
                localStorage.setItem('ohsCart', JSON.stringify(cartItems));
                displayCartItems();
                log(`üìù Quantity set to ${value} for item ${index}`);
            }
        }
        
        function removeItem(index) {
            if (cartItems[index] && confirm(`Remove ${cartItems[index].name}?`)) {
                cartItems.splice(index, 1);
                localStorage.setItem('ohsCart', JSON.stringify(cartItems));
                displayCartItems();
                log(`üóëÔ∏è Removed item ${index}`);
            }
        }
        
        // INITIALIZE ON PAGE LOAD
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Debug page loaded, initializing...');
            updateStatus('üîÑ Loading cart data...', 'warning');
            
            setTimeout(() => {
                loadCartData();
            }, 500);
        });
        
        // ERROR HANDLING
        window.addEventListener('error', function(e) {
            log(`‚ùå JavaScript Error: ${e.message}`);
            updateStatus(`‚ùå JavaScript Error: ${e.message}`, 'error');
        });
        
        log('üèÅ Debug script loaded and ready');
    </script>
</body>
</html>
