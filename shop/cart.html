<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- BRAND-FOCUSED TITLE: Targets your exact search terms -->
    <title>Shopping Cart | OHSHOCL | Organic Hypo Solutions | Utah Organic Sanitization Products</title>
    
    <!-- CLEAN META DESCRIPTION: Natural brand messaging -->
    <meta name="description" content="Complete your order of premium USDA Certified Organic and EPA registered hypochlorous acid products. Professional disinfectant supplies and organic cleaning solutions from Utah's trusted sanitization company.">

    <!-- BRAND KEYWORDS: SEO optimization -->
    <meta name="keywords" content="organic cleaning product cart, professional disinfectant ordering, bulk sanitizer purchasing, subscription cleaning products, Utah cleaning supply order, commercial product checkout, disinfectant bulk pricing, professional sanitizer cart, organic product ordering, cleaning supply purchasing">

    <!-- STANDARD SEO -->
    <meta name="author" content="OHSHOCL - Organic Hypo Solutions">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    
    <!-- CANONICAL URL -->
    <link rel="canonical" href="https://organichyposolutions.com/shop/cart.html">

    <!-- LOCATION TARGETING -->
    <meta name="geo.region" content="US-UT">
    <meta name="geo.placename" content="Utah">
    <meta name="geo.position" content="40.7608;-111.8910">
    <meta name="ICBM" content="40.7608, -111.8910">

    <!-- BUSINESS INFO -->
    <meta name="business.phone" content="+1-801-712-5663">
    <meta name="business.email" content="ohshocl@gmail.com">
    <meta name="business.hours" content="Mo-Fr 08:00-18:00, Sa 09:00-17:00">

    <!-- SOCIAL SHARING -->
    <meta property="og:title" content="Shopping Cart | OHSHOCL | Utah Organic Sanitization Products">
    <meta property="og:description" content="Complete your order of premium USDA Certified Organic and EPA registered disinfectant products for professional and residential use.">
    <meta property="og:url" content="https://organichyposolutions.com/shop/cart.html">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://organichyposolutions.com/images/ohs-cart-social.jpg">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="OHSHOCL">

    <!-- TWITTER CARDS -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Shopping Cart | OHSHOCL | Utah Organic Sanitization Products">
    <meta name="twitter:description" content="Professional hypochlorous acid products. USDA Certified Organic and EPA registered for commercial and residential use.">
    <meta name="twitter:image" content="https://organichyposolutions.com/images/ohs-cart-social.jpg">

    <!-- Favicon -->
    <link rel="icon" href="../assets/images/logos/ohs-favicon.ico">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/global-styles.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/pages.css">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HEKE217WEY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-HEKE217WEY');
    </script>

    <style>
        :root {
            --ohs-primary-blue: #2E5EAA;
            --ohs-accent-blue: #7DD3FC;
            --ohs-organic-green: #4ADE80;
            --ohs-dark-green: #22C55E;
            --ohs-premium-gold: #f59e0b;
            --ohs-light-gray: #f8f9fa;
            --ohs-dark-gray: #6c757d;
        }

        /* Global Cart Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--ohs-light-gray);
            padding-bottom: 0;
        }

        /* Promotional Banner Styling */
        .promo-banner {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 0.5rem 0;
            font-weight: 600;
            position: relative;
            z-index: 1002;
            box-shadow: 0 2px 10px rgba(34, 197, 94, 0.3);
        }

        .promo-text {
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .promo-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .promo-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Navigation Styling */
        .navbar {
            background-color: #2E5EAA !important;
            padding: 0.3rem 0 !important;
            box-shadow: none !important;
            min-height: 80px !important;
            position: sticky;
            top: 0;
            z-index: 1001;
        }

        .navbar-brand {
            color: white !important;
            font-size: 1.5rem !important;
            font-weight: bold !important;
            padding: 0.2rem 0 !important;
            display: flex !important;
            align-items: center !important;
        }

        .navbar-brand svg {
            width: 32px !important;
            height: 32px !important;
        }

        .navbar-nav .nav-link {
            color: white !important;
            font-weight: 500 !important;
            padding: 0.5rem 1rem !important;
            margin: 0 !important;
            border-radius: 0 !important;
            transition: all 0.2s ease !important;
            display: flex !important;
            align-items: center !important;
        }

        .navbar-nav .nav-link i {
            margin-right: 0.5rem !important;
            font-size: 0.9rem !important;
        }

        .navbar-nav .nav-link:hover {
            color: #7DD3FC !important;
            background-color: rgba(255, 255, 255, 0.1) !important;
        }

        .navbar-nav .nav-link.active,
        .navbar-nav .nav-link.fw-semibold {
            color: #7DD3FC !important;
            background-color: rgba(255, 255, 255, 0.15) !important;
        }

        .dropdown-menu {
            background-color: white !important;
            border: none !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
            padding: 0.5rem 0 !important;
            margin-top: 0.25rem !important;
        }

        .dropdown-item {
            color: #2E5EAA !important;
            padding: 0.5rem 1rem !important;
            border-radius: 0 !important;
            transition: all 0.2s ease !important;
        }

        .dropdown-item:hover,
        .dropdown-item:focus {
            background-color: #f8f9fa !important;
            color: #2E5EAA !important;
        }

        .dropdown-item i {
            width: 16px !important;
            margin-right: 8px !important;
        }

        .badge {
            font-size: 0.7rem !important;
            font-weight: normal !important;
        }

        /* STABLE HERO SECTION */
        .hero-section {
            background: linear-gradient(135deg, var(--ohs-primary-blue) 0%, var(--ohs-accent-blue) 100%);
            color: white;
            padding: 40px 0;
            position: relative;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .cert-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin: 0.2rem;
            display: inline-block;
        }

        /* Cart Container */
        .cart-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 2rem;
            margin-bottom: 2rem;
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* CART ITEMS - Enhanced Display */
        .cart-items-section {
            padding-right: 2rem;
        }

        .cart-item {
            border-bottom: 2px solid #f1f5f9;
            padding: 1.5rem;
            transition: all 0.3s ease;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            background: white !important;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            overflow: hidden;
            position: relative;
        }

        .cart-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--ohs-organic-green);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cart-item.organic::before {
            background: var(--ohs-organic-green);
        }

        .cart-item.premium::before {
            background: var(--ohs-premium-gold);
        }

        .cart-item:hover {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .cart-item:hover::before {
            opacity: 1;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .product-image {
            width: 90px;
            height: 90px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 3px solid white;
            position: relative;
            overflow: hidden;
        }

        .product-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .product-image:hover::after {
            opacity: 1;
        }

        .product-image.organic {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .product-image.premium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* ENHANCED QUANTITY CONTROLS */
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            background: #f8fafc;
            padding: 0.8rem;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .quantity-controls:hover {
            border-color: var(--ohs-organic-green);
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.1);
        }

        .quantity-btn {
            width: 40px;
            height: 40px;
            border: 2px solid var(--ohs-organic-green);
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--ohs-organic-green);
            font-weight: bold;
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .quantity-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--ohs-organic-green);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .quantity-btn:hover:not(:disabled)::before {
            width: 100%;
            height: 100%;
        }

        .quantity-btn:hover:not(:disabled) {
            color: white;
            transform: scale(1.05);
            z-index: 1;
        }

        .quantity-btn:hover:not(:disabled) i {
            position: relative;
            z-index: 2;
        }

        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #ccc;
            color: #ccc;
        }

        .quantity-input {
            border: 2px solid var(--ohs-organic-green);
            background: white;
            border-radius: 8px;
            width: 60px;
            height: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--ohs-primary-blue);
            outline: none;
            transition: all 0.3s ease;
        }

        .quantity-input:focus {
            border-color: var(--ohs-primary-blue);
            box-shadow: 0 0 8px rgba(46, 94, 170, 0.3);
            transform: scale(1.05);
        }

        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .quantity-input[type=number] {
            -moz-appearance: textfield;
        }

        /* ENHANCED WHOLESALE BADGES */
        .wholesale-threshold-badge {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin: 0.25rem 0;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .wholesale-threshold-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }

        .wholesale-threshold-badge:hover::before {
            left: 100%;
        }

        .wholesale-achieved-badge {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin: 0.25rem 0;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
            animation: pulse-green 2s infinite;
            position: relative;
        }

        @keyframes pulse-green {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3); 
            }
            50% { 
                transform: scale(1.02); 
                box-shadow: 0 4px 12px rgba(34, 197, 94, 0.5); 
            }
        }

        .wholesale-progress-bar {
            background: #e5e7eb;
            border-radius: 10px;
            height: 6px;
            overflow: hidden;
            margin: 0.5rem 0;
            position: relative;
        }

        .wholesale-progress-fill {
            background: linear-gradient(90deg, #3b82f6, #22c55e);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .wholesale-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer-progress 2s infinite;
        }

        @keyframes shimmer-progress {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* STICKY ORDER SUMMARY - Enhanced */
        .sticky-order-summary {
            position: sticky;
            top: 120px;
            background: linear-gradient(135deg, var(--ohs-primary-blue) 0%, #1e3a8a 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1001;
            border-radius: 15px;
            margin: 2rem 0;
            backdrop-filter: blur(10px);
            border: 4px solid var(--ohs-organic-green);
            transition: all 0.3s ease;
        }

        .sticky-order-summary::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--ohs-organic-green), var(--ohs-accent-blue), var(--ohs-organic-green));
            border-radius: 15px;
            z-index: -1;
            animation: glow-border 3s linear infinite;
        }

        @keyframes glow-border {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .order-summary-content {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 2rem;
            align-items: center;
        }

        .order-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            backdrop-filter: blur(10px);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .order-details {
            display: flex;
            gap: 3rem;
            align-items: center;
        }

        .order-detail-item {
            text-align: center;
            transition: all 0.3s ease;
        }

        .order-detail-item:hover {
            transform: scale(1.05);
        }

        .order-detail-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .order-detail-label {
            font-size: 0.8rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .checkout-cta {
            background: linear-gradient(135deg, var(--ohs-organic-green), var(--ohs-dark-green));
            border: none;
            border-radius: 15px;
            padding: 0.75rem 2rem;
            box-shadow: 0 6px 20px rgba(74, 222, 128, 0.4);
            transition: all 0.3s ease;
            min-width: 180px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .checkout-cta::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }

        .checkout-cta:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 222, 128, 0.6);
            background: linear-gradient(135deg, var(--ohs-dark-green), #16a34a);
        }

        .checkout-cta:hover:not(:disabled)::before {
            left: 100%;
        }

        .checkout-cta:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Pricing Display */
        .price-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--ohs-organic-green);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .item-total-column {
            min-width: 120px;
            max-width: 120px;
        }

        .item-price-column {
            min-width: 100px;
            max-width: 100px;
        }

        .original-price {
            text-decoration: line-through;
            color: #9ca3af;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .discount-amount {
            color: #22c55e;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .savings-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        /* Empty Cart */
        .empty-cart {
            text-align: center;
            padding: 4rem 2rem;
            color: #64748b;
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px dashed #e2e8f0;
            transition: all 0.3s ease;
        }

        .empty-cart:hover {
            border-color: var(--ohs-organic-green);
            transform: translateY(-2px);
        }

        .empty-cart i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }

        /* Product Recommendations */
        .recommendations-section {
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .recommendation-item {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .recommendation-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: var(--ohs-organic-green);
        }

        .recommendation-product-image {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-right: 1rem;
        }

        /* FOOTER STYLING */
        .footer-section {
            background: #000000;
            color: white;
            padding: 3rem 0 2rem 0;
            margin-top: 3rem;
            width: 100%;
        }

        .footer-brand {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .footer-brand-name {
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            margin: 0;
        }

        .footer-tagline {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 0;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .footer-heading {
            color: white;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .footer-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-list li {
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .footer-list a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.2s ease;
        }

        .footer-list a:hover {
            color: var(--ohs-accent-blue);
            text-decoration: none;
        }

        .footer-contact {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .footer-contact i {
            margin-right: 0.5rem;
            width: 16px;
            color: var(--ohs-accent-blue);
        }

        .footer-contact a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .footer-contact a:hover {
            color: var(--ohs-accent-blue);
        }

        .social-icons {
            margin-top: 1rem;
        }

        .social-icons a {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.2rem;
            margin-right: 1rem;
            transition: color 0.2s ease;
            text-decoration: none;
        }

        .social-icons a:hover {
            color: var(--ohs-accent-blue);
        }

        .footer-badges {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .footer-badge {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Badge styles */
        .badge-organic {
            background: linear-gradient(135deg, var(--ohs-organic-green), var(--ohs-dark-green));
            color: white;
        }

        .badge-premium {
            background: linear-gradient(135deg, var(--ohs-premium-gold), #d97706);
            color: white;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero-section {
                padding: 30px 0;
            }
            
            .cart-container {
                margin: 1rem;
                margin-top: 1rem;
            }
            
            .cart-items-section {
                padding-right: 0;
            }

            .quantity-controls {
                gap: 0.5rem;
                padding: 0.5rem;
            }

            .quantity-btn {
                width: 35px;
                height: 35px;
            }

            .order-summary-content {
                grid-template-columns: auto 1fr;
                gap: 1rem;
                text-align: center;
            }

            .order-details {
                gap: 1.5rem;
                justify-content: center;
            }

            .order-detail-value {
                font-size: 1.2rem;
            }

            .checkout-cta {
                min-width: auto;
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            .sticky-order-summary {
                top: 100px;
                margin: 1rem;
                padding: 1rem;
            }

            .cert-badge {
                font-size: 0.7rem;
                padding: 0.2rem 0.6rem;
            }

            .social-icons {
                justify-content: center;
            }

            .footer-badges {
                justify-content: center;
            }

            .recommendations-section {
                padding: 1rem;
            }

            .recommendation-item {
                padding: 1rem;
            }
        }

        /* Tablet */
        @media (min-width: 769px) and (max-width: 1024px) {
            .order-summary-content {
                gap: 1.5rem;
            }

            .order-details {
                gap: 2rem;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Loading states */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced notification styles */
        .notification {
            position: fixed;
            top: 120px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            max-width: 400px;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateX(450px);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .notification.success {
            background: linear-gradient(135deg, var(--ohs-organic-green), var(--ohs-dark-green));
            color: white;
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .notification.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .notification.info {
            background: linear-gradient(135deg, var(--ohs-primary-blue), #1e3a8a);
            color: white;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Coupon input styles */
        .coupon-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            backdrop-filter: blur(10px);
        }

        .coupon-input {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            color: var(--ohs-primary-blue);
            width: 150px;
            font-size: 0.9rem;
            margin-right: 0.5rem;
        }

        .coupon-input::placeholder {
            color: rgba(46, 94, 170, 0.6);
        }

        .coupon-apply-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            color: white;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .coupon-apply-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            transform: translateY(-1px);
        }

        /* Progress indicators */
        .cart-progress {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            backdrop-filter: blur(10px);
        }

        .progress-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .progress-value {
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* Quantity selector enhancements */
        .quantity-quick-select {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .quantity-quick-btn {
            background: rgba(46, 94, 170, 0.1);
            border: 1px solid rgba(46, 94, 170, 0.3);
            border-radius: 6px;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            color: var(--ohs-primary-blue);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quantity-quick-btn:hover {
            background: var(--ohs-primary-blue);
            color: white;
            transform: scale(1.05);
        }

        /* Advanced wholesale indicators */
        .wholesale-meter {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            backdrop-filter: blur(10px);
        }

        .wholesale-meter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .wholesale-meter-title {
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0.9;
        }

        .wholesale-meter-percentage {
            font-size: 0.75rem;
            font-weight: bold;
        }

        .wholesale-meter-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            height: 8px;
            overflow: hidden;
        }

        .wholesale-meter-fill {
            background: linear-gradient(90deg, var(--ohs-accent-blue), var(--ohs-organic-green));
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- Green Promotional Banner -->
    <div class="promo-banner text-center" id="promoBanner">
        <div class="container">
            <div class="d-flex justify-content-center align-items-center">
                <div class="text-center">
                    <span class="promo-text">
                        💰 <strong>BULK DISCOUNTS AS HIGH AS 42%</strong> available
                    </span>
                </div>
                <button class="promo-close ms-3" onclick="closeBanner()" aria-label="Close banner">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="../index.html">
                <svg width="32" height="32" viewBox="0 0 400 250" class="me-2">
                    <rect width="400" height="250" fill="#2E5EAA"/>
                    <text x="200" y="180" text-anchor="middle" fill="#7DD3FC" font-family="Arial, sans-serif" font-size="100" font-weight="bold">OHS</text>
                    <text x="200" y="210" text-anchor="middle" fill="#7DD3FC" font-family="Arial, sans-serif" font-size="20">Organic HypoSolutions</text>
                    <path d="M 320 80 Q 340 60 360 80 Q 340 100 320 80" fill="#4ADE80"/>
                    <path d="M 330 70 Q 350 50 370 70 Q 350 90 330 70" fill="#22C55E"/>
                </svg>
                Organic HypoSolutions
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../services.html">
                            <i class="fas fa-spray-can me-1"></i>Services
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../products.html">
                            <i class="fas fa-shopping-bag me-1"></i>Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../calculator.html">
                            <i class="fas fa-calculator me-1"></i>Calculator
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="../about.html" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-info-circle me-1"></i>About
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="../about.html">
                                <i class="fas fa-info-circle me-2"></i>About Us
                            </a></li>
                            <li><a class="dropdown-item" href="../science-certifications.html">
                                <i class="fas fa-microscope me-2"></i>Science & Certifications
                            </a></li>
                            <li><a class="dropdown-item" href="../contact.html">
                                <i class="fas fa-phone me-2"></i>Contact
                            </a></li>
                            <li><a class="dropdown-item" href="../legal-information.html">
                                <i class="fas fa-gavel me-2"></i>Legal Information
                            </a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle fw-semibold" href="#" id="shopDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-shopping-cart me-1"></i>Shop
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item active fw-semibold" href="cart.html">
                                <i class="fas fa-shopping-cart me-2"></i>View Cart 
                                <span id="cartBadgeDropdown" class="badge bg-danger ms-1" style="display: none;">0</span>
                            </a></li>
                            <li><a class="dropdown-item" href="book-service.html">
                                <i class="fas fa-calendar-plus me-2"></i>Book Service
                            </a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user me-1"></i>Account
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="../account/profile.html">
                                <i class="fas fa-building me-2"></i>Business Pricing
                                <span class="badge bg-warning text-dark ms-1">Coming Soon</span>
                            </a></li>
                            <li><a class="dropdown-item" href="../account/orders.html">
                                <i class="fas fa-user-circle me-2"></i>Consumer Pricing
                                <span class="badge bg-warning text-dark ms-1">Coming Soon</span>
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="../auth/login.html">
                                <i class="fas fa-sign-in-alt me-2"></i>Login
                                <span class="badge bg-warning text-dark ms-1">Coming Soon</span>
                            </a></li>
                            <li><a class="dropdown-item" href="../auth/register.html">
                                <i class="fas fa-user-plus me-2"></i>Register
                                <span class="badge bg-warning text-dark ms-1">Coming Soon</span>
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-5 fw-bold mb-3">Shopping Cart</h1>
                    <p class="lead mb-4">
                        Review your premium hypochlorous acid products before checkout. 
                        Professional-grade disinfectants with Utah's fastest delivery.
                    </p>
                    <div class="d-flex flex-wrap gap-1">
                        <span class="cert-badge">
                            <i class="fas fa-leaf me-1"></i> USDA Certified Organic
                        </span>
                        <span class="cert-badge">
                            <i class="fas fa-shield-alt me-1"></i> EPA Registered
                        </span>
                        <span class="cert-badge">
                            <i class="fas fa-shipping-fast me-1"></i> 2-4 Day Delivery
                        </span>
                        <span class="cert-badge">
                            <i class="fas fa-box-open me-1"></i> Wholesale Pricing
                        </span>
                    </div>
                </div>
                <div class="col-lg-6 text-end">
                    <div class="hero-stats">
                        <div class="row">
                            <div class="col-4 text-center">
                                <h3 class="mb-1" id="heroCartTotal">$0.00</h3>
                                <small class="text-light">Cart Total</small>
                            </div>
                            <div class="col-4 text-center">
                                <h4 class="mb-1" id="heroItemCount">0</h4>
                                <small class="text-light">Items</small>
                            </div>
                            <div class="col-4 text-center">
                                <a href="../products.html" class="btn btn-outline-light btn-sm">
                                    <i class="fas fa-arrow-left me-1"></i> Continue Shopping
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="cart-container p-4">
                    <!-- Cart Header -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3 class="mb-0">
                            <i class="fas fa-shopping-cart me-2 text-primary"></i>Shopping Cart
                        </h3>
                        <div class="d-flex gap-3 align-items-center">
                            <small class="text-muted" id="itemCount">0 items</small>
                            <button class="btn btn-outline-secondary btn-sm" onclick="saveCartForLater()" id="saveCartBtn">
                                <i class="fas fa-bookmark me-1"></i>Save for Later
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="clearAllItems()" id="clearCartBtn">
                                <i class="fas fa-trash me-1"></i>Clear All
                            </button>
                        </div>
                    </div>

                    <!-- Cart Progress Indicator -->
                    <div class="cart-progress" id="cartProgress" style="display: none;">
                        <div class="progress-item">
                            <span class="progress-label">
                                <i class="fas fa-shipping-fast me-1"></i>Free Shipping Progress
                            </span>
                            <span class="progress-value" id="shippingProgress">$0 / $75</span>
                        </div>
                        <div class="wholesale-meter-bar">
                            <div class="wholesale-meter-fill" id="shippingProgressBar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Cart Items Container -->
                    <div id="cartItems">
                        <!-- Items will be dynamically inserted here -->
                    </div>

                    <!-- Empty Cart Message -->
                    <div id="emptyCart" class="empty-cart">
                        <i class="fas fa-shopping-cart text-muted"></i>
                        <h4 class="mt-3 mb-3">Your cart is empty</h4>
                        <p class="text-muted mb-4">Browse our USDA Certified Organic and EPA registered products!</p>
                        <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center">
                            <a href="../products.html" class="btn btn-primary btn-lg">
                                <i class="fas fa-shopping-bag me-2"></i>Browse Products
                            </a>
                            <a href="../services.html" class="btn btn-outline-primary btn-lg">
                                <i class="fas fa-spray-can me-2"></i>View Services
                            </a>
                        </div>
                        <div class="mt-4">
                            <div class="row text-center">
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="cert-badge bg-success text-white mb-2">
                                            <i class="fas fa-leaf"></i>
                                        </div>
                                        <small class="text-muted">19 Organic Products</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="cert-badge bg-warning text-white mb-2">
                                            <i class="fas fa-crown"></i>
                                        </div>
                                        <small class="text-muted">38 Premium Products</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="cert-badge bg-primary text-white mb-2">
                                            <i class="fas fa-shipping-fast"></i>
                                        </div>
                                        <small class="text-muted">Calculated by Shopify</small>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="cert-badge bg-info text-white mb-2">
                                            <i class="fas fa-box-open"></i>
                                        </div>
                                        <small class="text-muted">Wholesale on Select Products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Recommendations -->
                    <div id="recommendations" class="recommendations-section" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">
                                <i class="fas fa-lightbulb me-2 text-warning"></i>You might also like
                            </h5>
                            <button class="btn btn-sm btn-outline-secondary" onclick="refreshRecommendations()">
                                <i class="fas fa-sync me-1"></i>Refresh
                            </button>
                        </div>
                        <div class="row" id="recommendationsContainer">
                            <!-- Dynamic recommendations will be inserted here -->
                        </div>
                        <div class="mt-3 p-3 rounded" style="background: rgba(74, 222, 128, 0.1); border: 1px solid #22c55e;">
                            <small class="text-success">
                                <i class="fas fa-info-circle me-1"></i>
                                <strong>Wholesale Tip:</strong> Many products offer wholesale pricing at specific quantity thresholds! Look for individual product thresholds in the cart.
                            </small>
                        </div>
                    </div>

                    <!-- STICKY ORDER SUMMARY -->
                    <div class="sticky-order-summary" id="stickyOrderSummary" style="display: none;">
                        <div class="order-summary-content">
                            <!-- Order Icon -->
                            <div class="order-icon">
                                <i class="fas fa-receipt"></i>
                            </div>
                            
                            <!-- Order Details -->
                            <div class="order-details">
                                <div class="order-detail-item">
                                    <div class="order-detail-value" id="stickySubtotal">$0.00</div>
                                    <div class="order-detail-label">Subtotal</div>
                                </div>
                                <div class="order-detail-item" id="stickyWholesaleSavings" style="display: none;">
                                    <div class="order-detail-value text-success" id="stickyWholesaleAmount">-$0.00</div>
                                    <div class="order-detail-label">Wholesale Savings</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-value" id="stickyTax">+Tax</div>
                                    <div class="order-detail-label">Utah Tax at Checkout</div>
                                </div>
                                <div class="order-detail-item">
                                    <div class="order-detail-value" id="stickyTotal">$0.00</div>
                                    <div class="order-detail-label">Total</div>
                                </div>
                            </div>
                            
                            <!-- Checkout Actions -->
                            <div class="checkout-actions">
                                <button class="btn checkout-cta" onclick="proceedToShopifyCheckout()" id="checkoutBtn">
                                    <i class="fas fa-lock me-2"></i>Secure Checkout
                                </button>
                            </div>
                        </div>

                        <!-- Coupon Section -->
                        <div class="coupon-section">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-tag me-2"></i>
                                <input type="text" class="coupon-input" placeholder="Coupon Code" id="couponCode">
                                <button class="coupon-apply-btn" onclick="applyCoupon()">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-md-3 mb-4">
                    <div class="footer-brand">
                        <svg width="40" height="40" viewBox="0 0 400 250" class="me-2">
                            <rect width="400" height="250" fill="#2E5EAA"/>
                            <text x="200" y="180" text-anchor="middle" fill="#7DD3FC" font-family="Arial, sans-serif" font-size="100" font-weight="bold">OHS</text>
                            <text x="200" y="210" text-anchor="middle" fill="#7DD3FC" font-family="Arial, sans-serif" font-size="20">Organic HypoSolutions</text>
                            <path d="M 320 80 Q 340 60 360 80 Q 340 100 320 80" fill="#4ADE80"/>
                            <path d="M 330 70 Q 350 50 370 70 Q 350 90 330 70" fill="#22C55E"/>
                        </svg>
                        <h5 class="footer-brand-name">Organic HypoSolutions</h5>
                    </div>
                    <p class="footer-tagline">Utah's dual-certified HOCl distributor for families and businesses.</p>
                    
                    <!-- Social Media Links -->
                    <div class="social-icons">
                        <a href="https://www.linkedin.com/company/organichyposolutions" target="_blank" aria-label="Follow us on LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <a href="https://www.facebook.com/organichyposolutions" target="_blank" aria-label="Like us on Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://www.instagram.com/organichyposolutions" target="_blank" aria-label="Follow us on Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
                
                <div class="col-md-2 mb-4">
                    <h6 class="footer-heading">Products</h6>
                    <ul class="footer-list">
                        <li><a href="../products.html">USDA Organic (19)</a></li>
                        <li><a href="../products.html">EPA Premium (38)</a></li>
                        <li><a href="../products.html">Bulk Solutions</a></li>
                        <li><a href="../products.html">All Products</a></li>
                    </ul>
                </div>
                
                <div class="col-md-2 mb-4">
                    <h6 class="footer-heading">Certified</h6>
                    <ul class="footer-list">
                        <li><span class="cert-badge">USDA Organic</span></li>
                        <li><span class="cert-badge">EPA Registered</span></li>
                        <li><span class="cert-badge">FDA Food Safe</span></li>
                    </ul>
                </div>
                
                <div class="col-md-2 mb-4">
                    <h6 class="footer-heading">Support</h6>
                    <ul class="footer-list">
                        <li><a href="../science-certifications.html">Science</a></li>
                        <li><a href="../calculator.html">Calculator</a></li>
                        <li><a href="../about.html">About</a></li>
                        <li><a href="../contact.html">Contact</a></li>
                    </ul>
                </div>
                
                <div class="col-md-3 mb-4">
                    <h6 class="footer-heading">Contact</h6>
                    <div class="footer-contact">
                        <p class="mb-2">
                            <i class="fas fa-phone"></i>
                            <a href="tel:+18017125663">(801) 712-5663</a>
                        </p>
                        <p class="mb-2">
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:ohshocl@gmail.com">ohshocl@gmail.com</a>
                        </p>
                        <p class="mb-3">
                            <i class="fas fa-map-marker-alt"></i>
                            Salt Lake City, UT, USA
                        </p>
                    </div>
                </div>
            </div>
            
            <hr class="my-4 border-secondary">
            
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2025 Organic HypoSolutions. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="footer-badges">
                        <span class="footer-badge">57 Products</span>
                        <span class="footer-badge">Family Owned & Operated Since 2025</span>
                        <span class="footer-badge">Shopify Secured</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Global Scripts -->
    <script src="../assets/js/global-scripts.js"></script>
    <script src="../assets/js/analytics.js"></script>
    
    <!-- Cart System JavaScript - MUST be loaded in this order -->
    <script src="js/cart.js"></script>
    <script src="js/shopify-client.js"></script>

    <script>
        // ===================================================================
        // CART SYSTEM INITIALIZATION WITH PRODUCT CATALOG INTEGRATION
        // ===================================================================
        let cartItems = [];
        let isCartSystemReady = false;
        let recommendationQuantities = { 'rec1': 1, 'rec2': 1, 'rec3': 1 };

        // Global banner close function
        function closeBanner() {
            const banner = document.getElementById('promoBanner');
            if (banner) {
                banner.style.display = 'none';
                localStorage.setItem('promoBannerClosed', 'true');
            }
        }

        // Check if banner should be shown
        function checkPromoBanner() {
            const bannerClosed = localStorage.getItem('promoBannerClosed');
            if (bannerClosed === 'true') {
                const banner = document.getElementById('promoBanner');
                if (banner) {
                    banner.style.display = 'none';
                }
            }
        }
        
        // ===================================================================
        // CART DATA MANAGEMENT WITH YOUR PRODUCT CATALOG
        // ===================================================================
        
        function loadCartFromLocalStorage() {
            try {
                const stored = localStorage.getItem('ohsCart');
                if (stored) {
                    const parsedCart = JSON.parse(stored);
                    // Convert to array format if needed
                    if (Array.isArray(parsedCart)) {
                        cartItems = parsedCart;
                    } else {
                        // Convert object format to array
                        cartItems = Object.keys(parsedCart).map(productId => ({
                            productId: productId,
                            name: parsedCart[productId].name || 'Unknown Product',
                            price: parseFloat(parsedCart[productId].price) || 0,
                            quantity: parseInt(parsedCart[productId].quantity) || 1,
                            type: parsedCart[productId].type || parsedCart[productId].productLine || 'organic',
                            description: parsedCart[productId].description || 'Professional hypochlorous acid product',
                            emoji: parsedCart[productId].emoji || (parsedCart[productId].type === 'premium' ? '👑' : '🌱'),
                            sku: parsedCart[productId].sku || '',
                            variantId: parsedCart[productId].variantId || null,
                            ...parsedCart[productId]
                        }));
                    }
                } else {
                    cartItems = [];
                }
                
                console.log('✅ Cart loaded:', cartItems.length, 'items');
            } catch (error) {
                console.error('❌ Error loading cart:', error);
                cartItems = [];
            }
        }
        
        function saveCartToLocalStorage() {
            try {
                localStorage.setItem('ohsCart', JSON.stringify(cartItems));
                console.log('💾 Cart saved successfully');
                // Dispatch storage event for cross-page updates
                window.dispatchEvent(new StorageEvent('storage', {
                    key: 'ohsCart',
                    newValue: JSON.stringify(cartItems)
                }));
            } catch (error) {
                console.error('❌ Error saving cart:', error);
            }
        }
        
        // ===================================================================
        // WHOLESALE CALCULATION USING YOUR PRODUCT CATALOG
        // ===================================================================
        
        function calculateWholesaleRate(productId, quantity) {
            // Wait for cart.js to load and provide PRODUCT_CATALOG
            if (typeof window.PRODUCT_CATALOG === 'undefined') {
                console.warn('Product catalog not yet loaded, using fallback calculation');
                return {
                    isWholesale: quantity >= 25,
                    threshold: 25,
                    discount: 0.25,
                    savingsPercent: quantity >= 25 ? 25 : 0,
                    retailPrice: 0,
                    wholesalePrice: 0
                };
            }

            const product = window.PRODUCT_CATALOG[productId];
            if (!product || !product.pricing) {
                console.warn(`Product ${productId} not found in catalog`);
                return {
                    isWholesale: false,
                    threshold: 25,
                    discount: 0,
                    savingsPercent: 0,
                    retailPrice: 0,
                    wholesalePrice: 0
                };
            }
            
            const threshold = product.wholesaleThreshold || 25;
            const isWholesale = quantity >= threshold;
            const retailPrice = product.pricing.retail || 0;
            const wholesalePrice = product.pricing.wholesale || retailPrice;
            const discount = retailPrice > 0 ? (retailPrice - wholesalePrice) / retailPrice : 0;
            
            return {
                isWholesale: isWholesale,
                threshold: threshold,
                discount: discount,
                savingsPercent: isWholesale ? Math.round(discount * 100) : 0,
                retailPrice: retailPrice,
                wholesalePrice: wholesalePrice,
                finalPrice: isWholesale ? wholesalePrice : retailPrice
            };
        }
        
        // ===================================================================
        // ENHANCED CART DISPLAY FUNCTIONS
        // ===================================================================
        
        function updateCartDisplay() {
            updateCartItems();
            updateOrderSummary();
            updateCartBadges();
            updateItemCount();
            updateHeroStats();
            updateStickyVisibility();
            updateShippingProgress();
            updateRecommendations();
        }
        
        function updateCartItems() {
            const container = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            
            if (!container || !emptyCart) return;
            
            if (cartItems.length === 0) {
                container.style.display = 'none';
                emptyCart.style.display = 'block';
                return;
            }
            
            container.style.display = 'block';
            emptyCart.style.display = 'none';
            
            let html = '';
            cartItems.forEach((item, index) => {
                const isOrganic = item.type === 'organic' || item.productLine === 'organic';
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                const displayPrice = wholesaleInfo.finalPrice || item.price;
                const itemTotal = displayPrice * item.quantity;
                
                // Get product info for enhanced display
                const product = window.PRODUCT_CATALOG ? window.PRODUCT_CATALOG[item.productId] : null;
                const certifications = product ? (product.certifications || []).join(', ') : '';
                
                html += `
                    <div class="cart-item ${isOrganic ? 'organic' : 'premium'}" data-index="${index}">
                        <div class="row align-items-center">
                            <div class="col-md-2 col-3 mb-3 mb-md-0">
                                <div class="product-image ${isOrganic ? 'organic' : 'premium'}">
                                    ${item.emoji || (isOrganic ? '🌱' : '👑')}
                                </div>
                            </div>
                            <div class="col-md-3 col-9 mb-3 mb-md-0">
                                <h6 class="fw-bold mb-2">${item.name}</h6>
                                <p class="text-muted small mb-2">${item.description}</p>
                                <div class="mb-2">
                                    <span class="badge ${isOrganic ? 'badge-organic' : 'badge-premium'}">
                                        ${isOrganic ? 'USDA Organic' : 'EPA Premium'}
                                    </span>
                                    ${item.sku ? `<span class="badge bg-info ms-1">${item.sku}</span>` : ''}
                                    ${certifications ? `<small class="d-block text-muted mt-1">${certifications}</small>` : ''}
                                </div>
                                
                                <!-- Wholesale Progress for Individual Product -->
                                <div class="wholesale-meter">
                                    <div class="wholesale-meter-header">
                                        <span class="wholesale-meter-title">
                                            ${wholesaleInfo.isWholesale ? 
                                                '<i class="fas fa-check-circle text-success"></i> Wholesale Achieved' :
                                                'Wholesale Progress'
                                            }
                                        </span>
                                        <span class="wholesale-meter-percentage">
                                            ${Math.min(100, Math.round((item.quantity / wholesaleInfo.threshold) * 100))}%
                                        </span>
                                    </div>
                                    <div class="wholesale-meter-bar">
                                        <div class="wholesale-meter-fill" style="width: ${Math.min(100, (item.quantity / wholesaleInfo.threshold) * 100)}%"></div>
                                    </div>
                                    <small class="text-muted">
                                        ${wholesaleInfo.isWholesale ? 
                                            `Saving ${wholesaleInfo.savingsPercent}% • Threshold: ${wholesaleInfo.threshold} units` :
                                            `Need ${wholesaleInfo.threshold - item.quantity} more for wholesale pricing`
                                        }
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-3 col-12 mb-3 mb-md-0">
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="changeQuantity(${index}, -1)" 
                                            ${item.quantity <= 1 ? 'disabled' : ''}>
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" class="quantity-input" value="${item.quantity}" 
                                           min="1" max="999" 
                                           onchange="setQuantity(${index}, this.value)"
                                           onclick="this.select()">
                                    <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                
                                <!-- Quick quantity selectors -->
                                <div class="quantity-quick-select">
                                    <span class="quantity-quick-btn" onclick="setQuantity(${index}, ${wholesaleInfo.threshold})">
                                        ${wholesaleInfo.threshold}
                                    </span>
                                    <span class="quantity-quick-btn" onclick="setQuantity(${index}, ${wholesaleInfo.threshold * 2})">
                                        ${wholesaleInfo.threshold * 2}
                                    </span>
                                    <span class="quantity-quick-btn" onclick="setQuantity(${index}, ${wholesaleInfo.threshold * 5})">
                                        ${wholesaleInfo.threshold * 5}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="price-display">$${displayPrice.toFixed(2)}</div>
                                <small class="text-muted">each</small>
                                ${wholesaleInfo.isWholesale && wholesaleInfo.retailPrice > wholesaleInfo.wholesalePrice ? `
                                    <div class="original-price">$${wholesaleInfo.retailPrice.toFixed(2)}</div>
                                    <div class="savings-badge">Save ${wholesaleInfo.savingsPercent}%</div>
                                ` : ''}
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="price-display mb-2">$${itemTotal.toFixed(2)}</div>
                                <div class="d-flex gap-1 justify-content-center">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="saveItemForLater(${index})" title="Save for later">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="removeItem(${index})" title="Remove item">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function updateOrderSummary() {
            let subtotal = 0;
            let totalWholesaleSavings = 0;
            
            cartItems.forEach(item => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                const finalPrice = wholesaleInfo.finalPrice || item.price;
                const itemTotal = finalPrice * item.quantity;
                subtotal += itemTotal;
                
                if (wholesaleInfo.isWholesale && wholesaleInfo.retailPrice > wholesaleInfo.wholesalePrice) {
                    const savings = (wholesaleInfo.retailPrice - wholesaleInfo.wholesalePrice) * item.quantity;
                    totalWholesaleSavings += savings;
                }
            });
            
            // Update sticky summary
            document.getElementById('stickySubtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('stickyTotal').textContent = '$' + subtotal.toFixed(2);
            
            // Show/hide wholesale savings
            const wholesaleSavingsElement = document.getElementById('stickyWholesaleSavings');
            if (totalWholesaleSavings > 0) {
                wholesaleSavingsElement.style.display = 'block';
                document.getElementById('stickyWholesaleAmount').textContent = '-$' + totalWholesaleSavings.toFixed(2);
            } else {
                wholesaleSavingsElement.style.display = 'none';
            }
        }
        
        function updateCartBadges() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            
            // Update all cart badges
            const badges = ['cartBadge', 'cartBadgeDropdown'];
            badges.forEach(badgeId => {
                const badge = document.getElementById(badgeId);
                if (badge) {
                    badge.style.display = totalItems > 0 ? 'inline-block' : 'none';
                    badge.textContent = totalItems;
                }
            });

            // Update global cart badge if available
            if (typeof updateCartBadge === 'function') {
                updateCartBadge();
            }
        }
        
        function updateItemCount() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const itemCount = document.getElementById('itemCount');
            if (itemCount) {
                itemCount.textContent = totalItems === 1 ? '1 item' : totalItems + ' items';
            }
        }
        
        function updateHeroStats() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            let subtotal = 0;
            
            cartItems.forEach(item => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                const finalPrice = wholesaleInfo.finalPrice || item.price;
                subtotal += finalPrice * item.quantity;
            });
            
            const heroTotal = document.getElementById('heroCartTotal');
            const heroCount = document.getElementById('heroItemCount');
            
            if (heroTotal) heroTotal.textContent = '$' + subtotal.toFixed(2);
            if (heroCount) heroCount.textContent = totalItems;
        }
        
        function updateStickyVisibility() {
            const stickyBar = document.getElementById('stickyOrderSummary');
            const progressBar = document.getElementById('cartProgress');
            
            if (cartItems.length > 0) {
                stickyBar.style.display = 'block';
                progressBar.style.display = 'block';
            } else {
                stickyBar.style.display = 'none';
                progressBar.style.display = 'none';
            }
        }

        function updateShippingProgress() {
            const subtotal = cartItems.reduce((sum, item) => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                const finalPrice = wholesaleInfo.finalPrice || item.price;
                return sum + (finalPrice * item.quantity);
            }, 0);

            const freeShippingThreshold = 75;
            const progress = Math.min(100, (subtotal / freeShippingThreshold) * 100);
            
            const progressElement = document.getElementById('shippingProgress');
            const progressBar = document.getElementById('shippingProgressBar');
            
            if (progressElement && progressBar) {
                if (subtotal >= freeShippingThreshold) {
                    progressElement.innerHTML = '<i class="fas fa-check-circle text-success"></i> Free Shipping Qualified!';
                } else {
                    const remaining = freeShippingThreshold - subtotal;
                    progressElement.textContent = `$${remaining.toFixed(2)} away from free shipping`;
                }
                progressBar.style.width = progress + '%';
            }
        }

        function updateRecommendations() {
            const recommendations = document.getElementById('recommendations');
            if (!recommendations || cartItems.length === 0) {
                if (recommendations) recommendations.style.display = 'none';
                return;
            }

            recommendations.style.display = 'block';
            
            // Simple recommendation logic based on cart contents
            const recommendedProducts = getRecommendedProducts();
            const container = document.getElementById('recommendationsContainer');
            
            if (container && recommendedProducts.length > 0) {
                let html = '';
                recommendedProducts.slice(0, 3).forEach((product, index) => {
                    const recId = `rec${index + 1}`;
                    html += `
                        <div class="col-md-4 mb-3">
                            <div class="recommendation-item">
                                <div class="d-flex align-items-center">
                                    <div class="recommendation-product-image ${product.type === 'organic' ? 'organic' : 'premium'}">
                                        ${product.emoji}
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">${product.name}</h6>
                                        <p class="small text-muted mb-1">${product.description}</p>
                                        <div class="price-display">$${product.pricing.retail.toFixed(2)}</div>
                                        <div class="d-flex align-items-center gap-2 mt-2">
                                            <div class="quantity-controls" style="padding: 0.3rem; gap: 0.3rem;">
                                                <button class="quantity-btn" style="width: 28px; height: 28px; font-size: 0.8rem;" 
                                                        onclick="changeRecommendationQuantity('${recId}', -1)" 
                                                        id="${recId}-minus" ${recommendationQuantities[recId] <= 1 ? 'disabled' : ''}>
                                                    <i class="fas fa-minus"></i>
                                                </button>
                                                <input type="number" class="quantity-input" style="width: 45px; height: 28px; font-size: 0.9rem;" 
                                                       value="${recommendationQuantities[recId] || 1}" 
                                                       min="1" max="999" id="${recId}-qty"
                                                       onchange="setRecommendationQuantity('${recId}', this.value)"
                                                       onclick="this.select()">
                                                <button class="quantity-btn" style="width: 28px; height: 28px; font-size: 0.8rem;" 
                                                        onclick="changeRecommendationQuantity('${recId}', 1)">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                            <button class="btn btn-sm btn-success" onclick="addRecommendationToCart('${recId}', '${product.id}')">
                                                <i class="fas fa-cart-plus me-1"></i>Add
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
        }

        function getRecommendedProducts() {
            if (typeof window.PRODUCT_CATALOG === 'undefined') {
                return [];
            }

            // Get product types in cart
            const cartProductTypes = cartItems.map(item => item.type || item.productLine);
            const cartProductIds = cartItems.map(item => item.productId);
            
            // Find complementary products
            const allProducts = Object.values(window.PRODUCT_CATALOG);
            return allProducts.filter(product => {
                // Exclude products already in cart
                if (cartProductIds.includes(product.id)) return false;
                
                // Simple recommendation logic
                if (cartProductTypes.includes('organic') && product.type === 'premium') return true;
                if (cartProductTypes.includes('premium') && product.type === 'organic') return true;
                if (product.category && product.category.includes('Bundle')) return true;
                
                return false;
            }).slice(0, 6);
        }
        
        // ===================================================================
        // ENHANCED CART MANAGEMENT FUNCTIONS
        // ===================================================================
        
        function changeQuantity(index, change) {
            if (!cartItems[index]) return;
            
            const newQuantity = Math.max(1, cartItems[index].quantity + change);
            cartItems[index].quantity = newQuantity;
            
            saveCartToLocalStorage();
            updateCartDisplay();
            
            // Show wholesale achievement notification
            const wholesaleInfo = calculateWholesaleRate(cartItems[index].productId, newQuantity);
            if (change > 0 && wholesaleInfo.isWholesale && (newQuantity - change) < wholesaleInfo.threshold) {
                showNotification(`🎉 Wholesale pricing achieved for ${cartItems[index].name}! Saving ${wholesaleInfo.savingsPercent}%`, 'success');
            }
        }
        
        function setQuantity(index, value) {
            if (!cartItems[index]) return;
            
            const newQuantity = Math.max(1, Math.min(999, parseInt(value) || 1));
            const oldQuantity = cartItems[index].quantity;
            cartItems[index].quantity = newQuantity;
            
            saveCartToLocalStorage();
            updateCartDisplay();
            
            // Show wholesale achievement notification
            const wholesaleInfo = calculateWholesaleRate(cartItems[index].productId, newQuantity);
            if (newQuantity > oldQuantity && wholesaleInfo.isWholesale && oldQuantity < wholesaleInfo.threshold) {
                showNotification(`🎉 Wholesale pricing achieved for ${cartItems[index].name}! Saving ${wholesaleInfo.savingsPercent}%`, 'success');
            }
        }
        
        function removeItem(index) {
            if (!cartItems[index]) return;
            
            if (confirm(`Remove "${cartItems[index].name}" from cart?`)) {
                const removedItem = cartItems[index];
                cartItems.splice(index, 1);
                saveCartToLocalStorage();
                updateCartDisplay();
                showNotification(`${removedItem.name} removed from cart`, 'info');
            }
        }
        
        function clearAllItems() {
            if (cartItems.length === 0) {
                showNotification('Your cart is already empty!', 'info');
                return;
            }
            
            if (confirm(`Clear all ${cartItems.length} items from cart?`)) {
                cartItems = [];
                saveCartToLocalStorage();
                updateCartDisplay();
                showNotification('Cart cleared successfully!', 'success');
            }
        }

        function saveCartForLater() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty!', 'info');
                return;
            }

            const savedCarts = JSON.parse(localStorage.getItem('ohsSavedCarts') || '[]');
            const cartToSave = {
                id: Date.now(),
                name: `Cart saved on ${new Date().toLocaleDateString()}`,
                items: [...cartItems],
                totalItems: cartItems.reduce((sum, item) => sum + item.quantity, 0),
                timestamp: new Date().toISOString()
            };

            savedCarts.unshift(cartToSave);
            localStorage.setItem('ohsSavedCarts', JSON.stringify(savedCarts.slice(0, 5))); // Keep only last 5

            showNotification('Cart saved for later!', 'success');
        }

        function saveItemForLater(index) {
            if (!cartItems[index]) return;

            const item = cartItems[index];
            const savedItems = JSON.parse(localStorage.getItem('ohsSavedItems') || '[]');
            
            savedItems.unshift({
                ...item,
                savedAt: new Date().toISOString()
            });

            localStorage.setItem('ohsSavedItems', JSON.stringify(savedItems.slice(0, 20))); // Keep only last 20
            
            cartItems.splice(index, 1);
            saveCartToLocalStorage();
            updateCartDisplay();
            
            showNotification(`${item.name} saved for later`, 'success');
        }
        
        // ===================================================================
        // ENHANCED SHOPIFY CHECKOUT INTEGRATION
        // ===================================================================
        
        async function proceedToShopifyCheckout() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty! Add some products first.', 'warning');
                return;
            }
            
            const checkoutBtn = document.getElementById('checkoutBtn');
            const originalText = checkoutBtn.innerHTML;
            
            // Show loading state
            checkoutBtn.disabled = true;
            checkoutBtn.innerHTML = '<span class="spinner me-2"></span>Creating Shopify Checkout...';
            
            try {
                console.log('🛒 Starting Shopify checkout process...');
                
                // Convert cart items to Shopify line items format using product catalog
                const lineItems = cartItems.map(item => {
                    const product = window.PRODUCT_CATALOG ? window.PRODUCT_CATALOG[item.productId] : null;
                    const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                    
                    // Determine which variant to use based on wholesale status
                    let variantId = item.variantId;
                    if (product && product.shopifyVariants) {
                        if (wholesaleInfo.isWholesale) {
                            variantId = product.shopifyVariants.wholesale || product.shopifyVariants.retail;
                        } else {
                            variantId = product.shopifyVariants.retail;
                        }
                    }
                    
                    return {
                        variantId: variantId || `gid://shopify/ProductVariant/${item.productId}`,
                        quantity: item.quantity,
                        customAttributes: [
                            { key: "Product_Name", value: item.name },
                            { key: "Product_ID", value: item.productId },
                            { key: "SKU", value: item.sku || '' },
                            { key: "Original_Price", value: (wholesaleInfo.retailPrice || item.price).toString() },
                            { key: "Final_Price", value: (wholesaleInfo.finalPrice || item.price).toString() },
                            { key: "Wholesale_Applied", value: wholesaleInfo.isWholesale.toString() },
                            { key: "Wholesale_Threshold", value: wholesaleInfo.threshold.toString() },
                            { key: "Product_Type", value: item.type || item.productLine || 'organic' },
                            { key: "Savings_Percent", value: wholesaleInfo.savingsPercent.toString() },
                            { key: "Category", value: product ? (product.category || '') : '' },
                            { key: "Certifications", value: product ? (product.certifications || []).join(', ') : '' }
                        ]
                    };
                });
                
                console.log('📋 Line items prepared for Shopify:', lineItems);
                
                // Call your API endpoint to create checkout
                const response = await fetch('/api/shopify/create-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        lineItems,
                        note: `Cart created from OHS website. Total items: ${cartItems.length}. Wholesale items: ${cartItems.filter(item => calculateWholesaleRate(item.productId, item.quantity).isWholesale).length}`
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Checkout API failed: ${response.status} ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('✅ Shopify checkout response:', result);
                
                if (result.checkoutUrl) {
                    // Track checkout initiation for analytics
                    if (typeof gtag !== 'undefined') {
                        const totalValue = cartItems.reduce((sum, item) => {
                            const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                            const finalPrice = wholesaleInfo.finalPrice || item.price;
                            return sum + (finalPrice * item.quantity);
                        }, 0);
                        
                        gtag('event', 'begin_checkout', {
                            'currency': 'USD',
                            'value': totalValue,
                            'items': cartItems.map(item => ({
                                'item_id': item.productId,
                                'item_name': item.name,
                                'quantity': item.quantity,
                                'price': item.price,
                                'item_category': item.type
                            }))
                        });
                        
                        console.log('📊 Analytics: Checkout event tracked', totalValue);
                    }
                    
                    console.log('🔗 Redirecting to Shopify checkout:', result.checkoutUrl);
                    
                    // Store checkout info for tracking
                    localStorage.setItem('ohsCheckoutId', result.checkoutId || '');
                    localStorage.setItem('ohsCheckoutTimestamp', new Date().toISOString());
                    
                    // Show success message before redirect
                    showNotification('Redirecting to secure checkout...', 'success');
                    
                    // Redirect to Shopify checkout after brief delay
                    setTimeout(() => {
                        window.location.href = result.checkoutUrl;
                    }, 1000);
                    
                } else {
                    throw new Error('No checkout URL received from Shopify');
                }
                
            } catch (error) {
                console.error('❌ Checkout error:', error);
                showNotification(`Checkout failed: ${error.message}. Please try again or contact support.`, 'error');
                
                // Reset button
                checkoutBtn.disabled = false;
                checkoutBtn.innerHTML = originalText;
            }
        }
        
        // ===================================================================
        // RECOMMENDATION SYSTEM FUNCTIONS
        // ===================================================================
        
        function changeRecommendationQuantity(recId, change) {
            const newQuantity = Math.max(1, (recommendationQuantities[recId] || 1) + change);
            recommendationQuantities[recId] = newQuantity;
            
            const input = document.getElementById(recId + '-qty');
            const minusBtn = document.getElementById(recId + '-minus');
            
            if (input) input.value = newQuantity;
            if (minusBtn) minusBtn.disabled = newQuantity <= 1;
        }
        
        function setRecommendationQuantity(recId, value) {
            const newQuantity = Math.max(1, Math.min(999, parseInt(value) || 1));
            recommendationQuantities[recId] = newQuantity;
            
            const input = document.getElementById(recId + '-qty');
            const minusBtn = document.getElementById(recId + '-minus');
            
            if (input) input.value = newQuantity;
            if (minusBtn) minusBtn.disabled = newQuantity <= 1;
        }
        
        function addRecommendationToCart(recId, productId) {
            if (typeof window.PRODUCT_CATALOG === 'undefined' || !window.PRODUCT_CATALOG[productId]) {
                showNotification('Product information not available', 'error');
                return;
            }
            
            const product = window.PRODUCT_CATALOG[productId];
            const quantity = recommendationQuantities[recId] || 1;
            
            const productData = {
                productId: product.id,
                name: product.name,
                price: product.pricing.retail,
                quantity: quantity,
                type: product.type || product.productLine || 'organic',
                description: product.description || 'Professional hypochlorous acid product',
                emoji: product.emoji || (product.type === 'premium' ? '👑' : '🌱'),
                sku: product.sku || '',
                variantId: product.shopifyVariants ? product.shopifyVariants.retail : null
            };
            
            const existingIndex = cartItems.findIndex(item => item.productId === productData.productId);
            
            if (existingIndex >= 0) {
                cartItems[existingIndex].quantity += quantity;
                showNotification(`Updated ${productData.name} quantity in cart!`, 'success');
            } else {
                cartItems.push(productData);
                showNotification(`Added ${quantity}x ${productData.name} to cart!`, 'success');
            }
            
            saveCartToLocalStorage();
            updateCartDisplay();
            
            // Reset recommendation quantity
            recommendationQuantities[recId] = 1;
            const input = document.getElementById(recId + '-qty');
            const minusBtn = document.getElementById(recId + '-minus');
            if (input) input.value = 1;
            if (minusBtn) minusBtn.disabled = true;
        }
        
        function refreshRecommendations() {
            updateRecommendations();
            showNotification('Recommendations refreshed!', 'info');
        }
        
        // ===================================================================
        // COUPON AND PROMOTIONAL FUNCTIONS
        // ===================================================================
        
        function applyCoupon() {
            const code = document.getElementById('couponCode').value.trim();
            
            if (!code) {
                showNotification('Please enter a coupon code', 'warning');
                return;
            }
            
            // Store coupon for checkout
            localStorage.setItem('ohsCouponCode', code);
            
            // Show success message
            showNotification(`Coupon "${code}" will be applied at checkout`, 'success');
            document.getElementById('couponCode').value = '';
            
            // Analytics tracking
            if (typeof gtag !== 'undefined') {
                gtag('event', 'coupon_applied', {
                    'coupon_code': code,
                    'cart_value': cartItems.reduce((sum, item) => {
                        const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                        return sum + ((wholesaleInfo.finalPrice || item.price) * item.quantity);
                    }, 0)
                });
            }
        }
        
        // ===================================================================
        // ENHANCED UTILITY FUNCTIONS
        // ===================================================================
        
        function showNotification(message, type = 'success') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => notif.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times-circle' : 'info-circle'} me-2"></i>
                    <div class="flex-grow-1">${message}</div>
                    <button type="button" class="btn-close btn-close-white ms-2" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.parentElement.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        function exportCart() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty!', 'warning');
                return;
            }
            
            const cartData = {
                timestamp: new Date().toISOString(),
                totalItems: cartItems.reduce((sum, item) => sum + item.quantity, 0),
                totalValue: cartItems.reduce((sum, item) => {
                    const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                    return sum + ((wholesaleInfo.finalPrice || item.price) * item.quantity);
                }, 0),
                items: cartItems.map(item => {
                    const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                    return {
                        productId: item.productId,
                        name: item.name,
                        sku: item.sku,
                        quantity: item.quantity,
                        unitPrice: wholesaleInfo.finalPrice || item.price,
                        totalPrice: (wholesaleInfo.finalPrice || item.price) * item.quantity,
                        wholesaleApplied: wholesaleInfo.isWholesale,
                        wholesaleThreshold: wholesaleInfo.threshold,
                        savingsPercent: wholesaleInfo.savingsPercent
                    };
                })
            };
            
            const dataStr = JSON.stringify(cartData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `ohs-cart-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Cart exported successfully!', 'success');
        }
        
        function importCart(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData.items && Array.isArray(importedData.items)) {
                        cartItems = importedData.items.map(item => ({
                            productId: item.productId,
                            name: item.name,
                            price: item.unitPrice,
                            quantity: item.quantity,
                            type: item.type || 'organic',
                            description: item.description || 'Imported product',
                            emoji: item.emoji || '📦',
                            sku: item.sku || '',
                            variantId: item.variantId || null
                        }));
                        
                        saveCartToLocalStorage();
                        updateCartDisplay();
                        showNotification(`Imported ${cartItems.length} items successfully!`, 'success');
                    } else {
                        throw new Error('Invalid cart file format');
                    }
                } catch (error) {
                    showNotification('Failed to import cart file', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function printCart() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty!', 'warning');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const printContent = generatePrintableCart();
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        function generatePrintableCart() {
            const totalValue = cartItems.reduce((sum, item) => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                return sum + ((wholesaleInfo.finalPrice || item.price) * item.quantity);
            }, 0);
            
            const totalWholesaleSavings = cartItems.reduce((sum, item) => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                if (wholesaleInfo.isWholesale && wholesaleInfo.retailPrice > wholesaleInfo.wholesalePrice) {
                    return sum + ((wholesaleInfo.retailPrice - wholesaleInfo.wholesalePrice) * item.quantity);
                }
                return sum;
            }, 0);
            
            let itemsHtml = '';
            cartItems.forEach(item => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                const finalPrice = wholesaleInfo.finalPrice || item.price;
                const itemTotal = finalPrice * item.quantity;
                
                itemsHtml += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.sku || 'N/A'}</td>
                        <td style="text-align: center;">${item.quantity}</td>
                        <td style="text-align: right;">${finalPrice.toFixed(2)}</td>
                        <td style="text-align: right;">${itemTotal.toFixed(2)}</td>
                        <td style="text-align: center;">${wholesaleInfo.isWholesale ? 'Yes' : 'No'}</td>
                    </tr>
                `;
            });
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>OHS Cart - ${new Date().toLocaleDateString()}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .logo { color: #2E5EAA; font-size: 24px; font-weight: bold; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; }
                        th { background-color: #f2f2f2; text-align: left; }
                        .summary { margin-top: 20px; }
                        .total-row { font-weight: bold; background-color: #f9f9f9; }
                        .savings { color: #22c55e; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">Organic HypoSolutions</div>
                        <p>Shopping Cart Summary - ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>SKU</th>
                                <th style="text-align: center;">Quantity</th>
                                <th style="text-align: right;">Unit Price</th>
                                <th style="text-align: right;">Total</th>
                                <th style="text-align: center;">Wholesale</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                    </table>
                    
                    <div class="summary">
                        <table style="width: 300px; margin-left: auto;">
                            <tr>
                                <td>Subtotal:</td>
                                <td style="text-align: right;">${totalValue.toFixed(2)}</td>
                            </tr>
                            ${totalWholesaleSavings > 0 ? `
                                <tr class="savings">
                                    <td>Wholesale Savings:</td>
                                    <td style="text-align: right;">-${totalWholesaleSavings.toFixed(2)}</td>
                                </tr>
                            ` : ''}
                            <tr>
                                <td>Tax (calculated at checkout):</td>
                                <td style="text-align: right;">TBD</td>
                            </tr>
                            <tr class="total-row">
                                <td>Total:</td>
                                <td style="text-align: right;">${totalValue.toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center; color: #666;">
                        <p>Contact: (801) 712-5663 | ohshocl@gmail.com</p>
                        <p>organichyposolutions.com</p>
                    </div>
                </body>
                </html>
            `;
        }
        
        // ===================================================================
        // CART ANALYTICS AND TRACKING
        // ===================================================================
        
        function trackCartEvent(eventType, additionalData = {}) {
            if (typeof gtag === 'undefined') return;
            
            const cartValue = cartItems.reduce((sum, item) => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                return sum + ((wholesaleInfo.finalPrice || item.price) * item.quantity);
            }, 0);
            
            const eventData = {
                'currency': 'USD',
                'value': cartValue,
                'items': cartItems.map(item => ({
                    'item_id': item.productId,
                    'item_name': item.name,
                    'quantity': item.quantity,
                    'price': item.price,
                    'item_category': item.type
                })),
                ...additionalData
            };
            
            gtag('event', eventType, eventData);
            console.log(`📊 Analytics: ${eventType} tracked`, eventData);
        }
        
        function calculateCartMetrics() {
            if (cartItems.length === 0) return null;
            
            const metrics = {
                totalItems: cartItems.reduce((sum, item) => sum + item.quantity, 0),
                uniqueProducts: cartItems.length,
                totalValue: 0,
                wholesaleItems: 0,
                retailItems: 0,
                totalSavings: 0,
                averageOrderValue: 0,
                organicProducts: 0,
                premiumProducts: 0
            };
            
            cartItems.forEach(item => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                const finalPrice = wholesaleInfo.finalPrice || item.price;
                
                metrics.totalValue += finalPrice * item.quantity;
                
                if (wholesaleInfo.isWholesale) {
                    metrics.wholesaleItems += 1;
                    if (wholesaleInfo.retailPrice > wholesaleInfo.wholesalePrice) {
                        metrics.totalSavings += (wholesaleInfo.retailPrice - wholesaleInfo.wholesalePrice) * item.quantity;
                    }
                } else {
                    metrics.retailItems += 1;
                }
                
                if (item.type === 'organic' || item.productLine === 'organic') {
                    metrics.organicProducts += 1;
                } else {
                    metrics.premiumProducts += 1;
                }
            });
            
            metrics.averageOrderValue = metrics.totalValue / metrics.uniqueProducts;
            
            return metrics;
        }
        
        // ===================================================================
        // KEYBOARD SHORTCUTS AND ACCESSIBILITY
        // ===================================================================
        
        function initializeKeyboardShortcuts() {
            document.addEventListener('keydown', function(event) {
                // Ctrl/Cmd + S = Save cart for later
                if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                    event.preventDefault();
                    saveCartForLater();
                }
                
                // Ctrl/Cmd + P = Print cart
                if ((event.ctrlKey || event.metaKey) && event.key === 'p') {
                    event.preventDefault();
                    printCart();
                }
                
                // Ctrl/Cmd + E = Export cart
                if ((event.ctrlKey || event.metaKey) && event.key === 'e') {
                    event.preventDefault();
                    exportCart();
                }
                
                // Delete key = Clear cart (with confirmation)
                if (event.key === 'Delete' && event.shiftKey) {
                    event.preventDefault();
                    clearAllItems();
                }
                
                // Enter key in checkout = Proceed to checkout
                if (event.key === 'Enter' && event.target.closest('#stickyOrderSummary')) {
                    event.preventDefault();
                    proceedToShopifyCheckout();
                }
            });
        }
        
        // ===================================================================
        // CART PERSISTENCE AND RECOVERY
        // ===================================================================
        
        function enableCartRecovery() {
            // Save cart state periodically
            setInterval(() => {
                if (cartItems.length > 0) {
                    const cartState = {
                        items: cartItems,
                        timestamp: new Date().toISOString(),
                        url: window.location.href,
                        userAgent: navigator.userAgent.substring(0, 100)
                    };
                    localStorage.setItem('ohsCartRecovery', JSON.stringify(cartState));
                }
            }, 30000); // Every 30 seconds
            
            // Check for abandoned cart on page load
            const recoveryData = localStorage.getItem('ohsCartRecovery');
            if (recoveryData && cartItems.length === 0) {
                try {
                    const recovery = JSON.parse(recoveryData);
                    const timeDiff = new Date() - new Date(recovery.timestamp);
                    
                    // If cart was abandoned within last 24 hours
                    if (timeDiff < 24 * 60 * 60 * 1000 && recovery.items.length > 0) {
                        setTimeout(() => {
                            if (confirm(`We found ${recovery.items.length} items from your previous session. Would you like to restore them?`)) {
                                cartItems = recovery.items;
                                saveCartToLocalStorage();
                                updateCartDisplay();
                                showNotification('Cart restored successfully!', 'success');
                                
                                // Track cart recovery
                                trackCartEvent('cart_recovered', { 
                                    'recovered_items': recovery.items.length,
                                    'time_since_abandonment': Math.round(timeDiff / 60000) // minutes
                                });
                            }
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Error recovering cart:', error);
                }
            }
        }
        
        // ===================================================================
        // ADVANCED CART FEATURES
        // ===================================================================
        
        function duplicateCart() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty!', 'warning');
                return;
            }
            
            const duplicatedItems = cartItems.map(item => ({
                ...item,
                quantity: item.quantity // Keep same quantities
            }));
            
            cartItems.push(...duplicatedItems);
            saveCartToLocalStorage();
            updateCartDisplay();
            
            showNotification(`Cart duplicated! Added ${duplicatedItems.length} more items.`, 'success');
            trackCartEvent('cart_duplicated', { 'duplicated_items': duplicatedItems.length });
        }
        
        function optimizeForWholesale() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty!', 'warning');
                return;
            }
            
            let optimizedCount = 0;
            
            cartItems.forEach(item => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                if (!wholesaleInfo.isWholesale && wholesaleInfo.threshold > 0) {
                    item.quantity = wholesaleInfo.threshold;
                    optimizedCount++;
                }
            });
            
            if (optimizedCount > 0) {
                saveCartToLocalStorage();
                updateCartDisplay();
                showNotification(`Optimized ${optimizedCount} products for wholesale pricing!`, 'success');
                trackCartEvent('cart_optimized_wholesale', { 'optimized_items': optimizedCount });
            } else {
                showNotification('All eligible items already have wholesale pricing!', 'info');
            }
        }
        
        function shareCart() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty!', 'warning');
                return;
            }
            
            const cartSummary = cartItems.map(item => 
                `${item.quantity}x ${item.name} - ${((calculateWholesaleRate(item.productId, item.quantity).finalPrice || item.price) * item.quantity).toFixed(2)}`
            ).join('\n');
            
            const totalValue = cartItems.reduce((sum, item) => {
                const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                return sum + ((wholesaleInfo.finalPrice || item.price) * item.quantity);
            }, 0);
            
            const shareText = `My OHS Cart (${cartItems.length} items - ${totalValue.toFixed(2)}):\n\n${cartSummary}\n\nShop at organichyposolutions.com`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My OHS Shopping Cart',
                    text: shareText,
                    url: window.location.href
                }).catch(console.error);
            } else if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification('Cart summary copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('Unable to copy cart summary', 'error');
                });
            } else {
                showNotification('Sharing not supported on this device', 'info');
            }
        }
        
        // ===================================================================
        // INITIALIZATION AND EVENT LISTENERS
        // ===================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Enhanced cart system initializing...');
            
            // Check promotional banner
            checkPromoBanner();
            
            // Load cart data
            loadCartFromLocalStorage();
            
            // Update display
            updateCartDisplay();
            
            // Initialize advanced features
            initializeKeyboardShortcuts();
            enableCartRecovery();
            
            // Listen for storage changes (cross-tab cart sync)
            window.addEventListener('storage', function(e) {
                if (e.key === 'ohsCart') {
                    console.log('🔄 Cart updated in another tab, reloading...');
                    loadCartFromLocalStorage();
                    updateCartDisplay();
                }
            });
            
            // Initialize tooltips if Bootstrap is available
            if (typeof bootstrap !== 'undefined') {
                const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
                tooltips.forEach(tooltip => new bootstrap.Tooltip(tooltip));
            }
            
            // Page visibility change tracking
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'hidden' && cartItems.length > 0) {
                    // Track cart abandonment
                    trackCartEvent('cart_abandoned', {
                        'abandonment_time': new Date().toISOString(),
                        'cart_value': cartItems.reduce((sum, item) => {
                            const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                            return sum + ((wholesaleInfo.finalPrice || item.price) * item.quantity);
                        }, 0)
                    });
                }
            });
            
            // Warn before leaving page with items in cart
            window.addEventListener('beforeunload', function(e) {
                if (cartItems.length > 0) {
                    const message = 'You have items in your cart. Are you sure you want to leave?';
                    e.returnValue = message;
                    return message;
                }
            });
            
            isCartSystemReady = true;
            console.log('✅ Enhanced cart system ready with', cartItems.length, 'items!');
            
            // Track page load
            trackCartEvent('cart_page_viewed', {
                'items_in_cart': cartItems.length,
                'cart_value': cartItems.reduce((sum, item) => {
                    const wholesaleInfo = calculateWholesaleRate(item.productId, item.quantity);
                    return sum + ((wholesaleInfo.finalPrice || item.price) * item.quantity);
                }, 0)
            });
        });
        
        // ===================================================================
        // GLOBAL FUNCTION EXPOSURE
        // ===================================================================
        
        // Expose functions for external access and testing
        window.changeQuantity = changeQuantity;
        window.setQuantity = setQuantity;
        window.removeItem = removeItem;
        window.clearAllItems = clearAllItems;
        window.saveCartForLater = saveCartForLater;
        window.saveItemForLater = saveItemForLater;
        window.proceedToShopifyCheckout = proceedToShopifyCheckout;
        window.proceedToCheckout = proceedToShopifyCheckout; // Alias for compatibility
        window.applyCoupon = applyCoupon;
        window.changeRecommendationQuantity = changeRecommendationQuantity;
        window.setRecommendationQuantity = setRecommendationQuantity;
        window.addRecommendationToCart = addRecommendationToCart;
        window.refreshRecommendations = refreshRecommendations;
        window.exportCart = exportCart;
        window.importCart = importCart;
        window.printCart = printCart;
        window.duplicateCart = duplicateCart;
        window.optimizeForWholesale = optimizeForWholesale;
        window.shareCart = shareCart;
        window.calculateCartMetrics = calculateCartMetrics;
        
        // Advanced testing and debugging functions
        window.addTestItem = function(productId, name, price, type = 'organic', quantity = 1) {
            cartItems.push({
                productId: productId || 'test-' + Date.now(),
                name: name || 'Test Product',
                price: price || 25.00,
                quantity: quantity,
                type: type,
                description: 'Test product for development',
                emoji: type === 'premium' ? '👑' : '🌱',
                sku: 'TEST-SKU-' + Date.now(),
                variantId: null
            });
            saveCartToLocalStorage();
            updateCartDisplay();
            console.log('✅ Test item added to cart');
        };
        
        window.loadTestCart = function() {
            cartItems = [
                {
                    productId: 'hc-32oz-pet-cleaner',
                    name: '32oz Pet Cleaner and Deodorizer',
                    price: 23.82,
                    quantity: 30,
                    type: 'premium',
                    description: 'Professional pet cleaning solution',
                    emoji: '🐾',
                    sku: 'HC-32OZ-PET-CLEANER',
                    variantId: null
                },
                {
                    productId: 'ohs-3oz-organic-disinfectant',
                    name: '3oz Organic Multi-Surface Disinfectant',
                    price: 12.97,
                    quantity: 50,
                    type: 'organic',
                    description: 'USDA Certified Organic disinfectant',
                    emoji: '✨',
                    sku: 'OHS-3OZ-ORGANIC',
                    variantId: null
                }
            ];
            saveCartToLocalStorage();
            updateCartDisplay();
            console.log('✅ Test cart loaded with wholesale items');
        };
        
        window.debugCart = function() {
            console.log('🐛 Cart Debug Info:');
            console.log('Cart Items:', cartItems);
            console.log('Local Storage:', localStorage.getItem('ohsCart'));
            console.log('Cart Ready:', isCartSystemReady);
            console.log('Product Catalog Available:', typeof window.PRODUCT_CATALOG !== 'undefined');
            console.log('Cart Metrics:', calculateCartMetrics());
            if (typeof window.PRODUCT_CATALOG !== 'undefined') {
                console.log('Products in Catalog:', Object.keys(window.PRODUCT_CATALOG).length);
            }
        };
        
        // Compatibility function for products page
        window.addToCart = function(productId, name, price, emoji, quantity = 1, variantId = null, sku = null) {
            const product = window.PRODUCT_CATALOG ? window.PRODUCT_CATALOG[productId] : null;
            
            const cartItem = {
                productId: productId,
                name: name,
                price: parseFloat(price),
                quantity: parseInt(quantity),
                type: product ? (product.type || product.productLine) : 'organic',
                description: product ? product.description : 'Professional hypochlorous acid product',
                emoji: emoji || (product ? product.emoji : '🧽'),
                sku: sku || (product ? product.sku : ''),
                variantId: variantId || (product && product.shopifyVariants ? product.shopifyVariants.retail : null)
            };
            
            const existingIndex = cartItems.findIndex(item => item.productId === productId);
            
            if (existingIndex >= 0) {
                cartItems[existingIndex].quantity += cartItem.quantity;
            } else {
                cartItems.push(cartItem);
            }
            
            saveCartToLocalStorage();
            updateCartDisplay();
            
            showNotification(`Added ${quantity}x ${name} to cart!`, 'success');
            trackCartEvent('add_to_cart', {
                'item_id': productId,
                'item_name': name,
                'quantity': quantity,
                'price': price
            });
            
            return true;
        };
    </script>
</body>
</html>
