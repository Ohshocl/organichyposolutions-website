<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout - Organic Hypo Solutions | Complete Your Order</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Stripe JS -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Complete your secure checkout for USDA Certified Organic HOCl products. Multiple payment options with SSL encryption and fraud protection.">
    <meta name="keywords" content="secure checkout, organic disinfectant payment, HOCl order, secure payment processing">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Secure Checkout - Organic Hypo Solutions">
    <meta property="og:description" content="Complete your order with secure payment processing">
    <meta property="og:url" content="https://organichyposolutions.com/shop/checkout.html">
    <meta property="og:type" content="website">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://js.stripe.com https://api.stripe.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline' https://js.stripe.com https://cdn.jsdelivr.net https://www.googletagmanager.com">
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Secure Checkout",
      "description": "Complete your order of USDA Certified Organic HOCl products with secure payment processing",
      "url": "https://organichyposolutions.com/shop/checkout.html",
      "provider": {
        "@type": "Organization",
        "name": "Organic Hypo Solutions",
        "url": "https://organichyposolutions.com"
      }
    }
    </script>
    
    <style>
        :root {
            --primary-color: #28a745;
            --secondary-color: #6c757d;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --premium-gold: #ffd700;
            --wholesale-blue: #0056b3;
            --success-green: #28a745;
            --secure-blue: #007bff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--primary-color) !important;
        }

        .checkout-header {
            background: linear-gradient(135deg, var(--primary-color), #20c997);
            color: white;
            padding: 2rem 0;
        }

        .checkout-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-top: -1rem;
            position: relative;
            z-index: 10;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 1rem 0;
            border-bottom: 2px solid #e9ecef;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .step::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #dee2e6;
            z-index: 1;
        }

        .step:last-child::after {
            display: none;
        }

        .step.active .step-number {
            background: var(--primary-color);
            color: white;
        }

        .step.completed .step-number {
            background: var(--success-green);
            color: white;
        }

        .step.completed::after {
            background: var(--success-green);
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #dee2e6;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: bold;
            position: relative;
            z-index: 2;
        }

        .form-section {
            background: white;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .form-section:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.1);
        }

        .form-section h5 {
            color: var(--primary-color);
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .order-summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            border: 1px solid #dee2e6;
            position: sticky;
            top: 2rem;
        }

        .order-item {
            border-bottom: 1px solid #e9ecef;
            padding: 1rem 0;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #dee2e6;
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .total-row {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            background: rgba(40, 167, 69, 0.1);
            margin: 0 -1rem;
            padding: 1rem;
            border-radius: 8px;
        }

        .payment-methods {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .payment-method {
            padding: 0.75rem 1rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 80px;
        }

        .payment-method:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .payment-method.active {
            border-color: var(--primary-color);
            background: rgba(40, 167, 69, 0.1);
        }

        .stripe-element {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 1rem;
            transition: border-color 0.3s ease;
        }

        .stripe-element:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

        .security-indicators {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .security-badge {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .digital-wallet-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .digital-wallet-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .digital-wallet-btn {
            background: #000;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .digital-wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .apple-pay-btn {
            background: #000 !important;
        }

        .google-pay-btn {
            background: #4285f4 !important;
        }

        .paypal-btn {
            background: #0070ba !important;
        }

        .business-account-section {
            background: linear-gradient(135deg, #e3f2fd, #f0f8ff);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 2px solid var(--wholesale-blue);
        }

        .progress-bar-custom {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #20c997);
            transition: width 0.5s ease;
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .success-message {
            color: var(--success-green);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .under-construction {
            background: linear-gradient(45deg, #ff6b35, var(--warning-color));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            display: inline-block;
            margin: 0.5rem 0;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }

        .trust-signals {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
        }

        .trust-signals h6 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .trust-badges {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .trust-badge {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        @media (max-width: 768px) {
            .checkout-header {
                padding: 1.5rem 0;
            }
            
            .step {
                font-size: 0.875rem;
            }
            
            .step::after {
                display: none;
            }
            
            .payment-methods {
                gap: 0.5rem;
            }
            
            .digital-wallet-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .digital-wallet-btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>

    <!-- Checkout Header -->
    <section class="checkout-header">
        <div class="container">
            <div class="text-center">
                <h1 class="display-6 fw-bold mb-2">
                    <i class="fas fa-shield-alt me-2"></i>Secure Checkout
                </h1>
                <p class="lead mb-0">Complete your order with confidence</p>
            </div>
        </div>
    </section>

    <!-- Main Checkout Content -->
    <div class="container py-4">
        <div class="checkout-container p-4">
            
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step completed" id="step1">
                    <div class="step-number">1</div>
                    <div>Cart Review</div>
                </div>
                <div class="step active" id="step2">
                    <div class="step-number">2</div>
                    <div>Information</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div>Payment</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div>Confirmation</div>
                </div>
            </div>

            <form id="checkoutForm">
                <div class="row">
                    <!-- Left Column - Form Sections -->
                    <div class="col-lg-8">
                        
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h5><i class="fas fa-user text-primary me-2"></i>Customer Information</h5>
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="firstName" class="form-label">First Name *</label>
                                    <input type="text" class="form-control" id="firstName" name="firstName" required>
                                    <div class="error-message" id="firstNameError"></div>
                                </div>
                                <div class="col-md-6">
                                    <label for="lastName" class="form-label">Last Name *</label>
                                    <input type="text" class="form-control" id="lastName" name="lastName" required>
                                    <div class="error-message" id="lastNameError"></div>
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email Address *</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                    <div class="error-message" id="emailError"></div>
                                    <div class="success-message" id="emailSuccess">‚úì Email verified</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="phone" class="form-label">Phone Number *</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" required>
                                    <div class="error-message" id="phoneError"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Business Information (for wholesale customers) -->
                        <div class="business-account-section" id="businessSection" style="display: none;">
                            <h5><i class="fas fa-building text-primary me-2"></i>Business Information</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="companyName" class="form-label">Company Name *</label>
                                    <input type="text" class="form-control" id="companyName" name="companyName">
                                </div>
                                <div class="col-md-6">
                                    <label for="taxId" class="form-label">Tax ID / EIN</label>
                                    <input type="text" class="form-control" id="taxId" name="taxId">
                                </div>
                                <div class="col-md-6">
                                    <label for="businessType" class="form-label">Business Type</label>
                                    <select class="form-select" id="businessType" name="businessType">
                                        <option value="">Select type</option>
                                        <option value="healthcare">Healthcare Facility</option>
                                        <option value="education">Educational Institution</option>
                                        <option value="retail">Retail Business</option>
                                        <option value="restaurant">Restaurant/Food Service</option>
                                        <option value="gym">Gym/Fitness Center</option>
                                        <option value="office">Office/Corporate</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="purchaseOrderNumber" class="form-label">Purchase Order Number</label>
                                    <input type="text" class="form-control" id="purchaseOrderNumber" name="purchaseOrderNumber">
                                </div>
                            </div>
                        </div>

                        <!-- Billing Address -->
                        <div class="form-section">
                            <h5><i class="fas fa-credit-card text-primary me-2"></i>Billing Address</h5>
                            
                            <div class="row g-3">
                                <div class="col-12">
                                    <label for="billingAddress" class="form-label">Street Address *</label>
                                    <input type="text" class="form-control" id="billingAddress" name="billingAddress" required>
                                    <div class="error-message" id="billingAddressError"></div>
                                </div>
                                <div class="col-md-6">
                                    <label for="billingCity" class="form-label">City *</label>
                                    <input type="text" class="form-control" id="billingCity" name="billingCity" required>
                                    <div class="error-message" id="billingCityError"></div>
                                </div>
                                <div class="col-md-3">
                                    <label for="billingState" class="form-label">State *</label>
                                    <select class="form-select" id="billingState" name="billingState" required>
                                        <option value="">Select state</option>
                                        <option value="UT" selected>Utah</option>
                                        <option value="AZ">Arizona</option>
                                        <option value="CO">Colorado</option>
                                        <option value="ID">Idaho</option>
                                        <option value="NV">Nevada</option>
                                        <option value="WY">Wyoming</option>
                                        <!-- Add more states as needed -->
                                    </select>
                                    <div class="error-message" id="billingStateError"></div>
                                </div>
                                <div class="col-md-3">
                                    <label for="billingZip" class="form-label">ZIP Code *</label>
                                    <input type="text" class="form-control" id="billingZip" name="billingZip" required>
                                    <div class="error-message" id="billingZipError"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Shipping Address -->
                        <div class="form-section">
                            <h5><i class="fas fa-shipping-fast text-primary me-2"></i>Shipping Address</h5>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="sameAsbilling" name="sameAsBinding" checked>
                                <label class="form-check-label" for="sameAsBinding">
                                    Same as billing address
                                </label>
                            </div>
                            
                            <div id="shippingAddressFields" style="display: none;">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label for="shippingAddress" class="form-label">Street Address *</label>
                                        <input type="text" class="form-control" id="shippingAddress" name="shippingAddress">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="shippingCity" class="form-label">City *</label>
                                        <input type="text" class="form-control" id="shippingCity" name="shippingCity">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="shippingState" class="form-label">State *</label>
                                        <select class="form-select" id="shippingState" name="shippingState">
                                            <option value="">Select state</option>
                                            <option value="UT" selected>Utah</option>
                                            <option value="AZ">Arizona</option>
                                            <option value="CO">Colorado</option>
                                            <option value="ID">Idaho</option>
                                            <option value="NV">Nevada</option>
                                            <option value="WY">Wyoming</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="shippingZip" class="form-label">ZIP Code *</label>
                                        <input type="text" class="form-control" id="shippingZip" name="shippingZip">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Digital Wallet Options -->
                        <div class="digital-wallet-section">
                            <h5><i class="fas fa-wallet text-primary me-2"></i>Express Checkout</h5>
                            <p class="text-muted mb-3">Pay securely with your preferred digital wallet</p>
                            
                            <div class="digital-wallet-buttons">
                                <button type="button" class="digital-wallet-btn apple-pay-btn" onclick="payWithApplePay()">
                                    <i class="fab fa-apple"></i> Apple Pay
                                </button>
                                <button type="button" class="digital-wallet-btn google-pay-btn" onclick="payWithGooglePay()">
                                    <i class="fab fa-google"></i> Google Pay
                                </button>
                                <button type="button" class="digital-wallet-btn paypal-btn" onclick="payWithPayPal()">
                                    <i class="fab fa-paypal"></i> PayPal
                                </button>
                            </div>
                            
                            <div class="under-construction text-center mt-2">
                                <i class="fas fa-wrench"></i> Digital wallet integration under construction
                            </div>
                        </div>

                        <!-- Payment Method Selection -->
                        <div class="form-section">
                            <h5><i class="fas fa-credit-card text-primary me-2"></i>Payment Method</h5>
                            
                            <div class="payment-methods">
                                <div class="payment-method active" data-method="card" onclick="selectPaymentMethod('card')">
                                    <i class="fas fa-credit-card fa-2x mb-2"></i>
                                    <div>Credit Card</div>
                                </div>
                                <div class="payment-method" data-method="net30" onclick="selectPaymentMethod('net30')">
                                    <i class="fas fa-file-invoice fa-2x mb-2"></i>
                                    <div>Net 30</div>
                                </div>
                                <div class="payment-method" data-method="ach" onclick="selectPaymentMethod('ach')">
                                    <i class="fas fa-university fa-2x mb-2"></i>
                                    <div>ACH Transfer</div>
                                </div>
                            </div>

                            <!-- Credit Card Form -->
                            <div id="cardPaymentForm" style="display: block;">
                                <div class="row g-3 mt-3">
                                    <div class="col-12">
                                        <label for="cardElement" class="form-label">Card Information *</label>
                                        <div id="cardElement" class="stripe-element">
                                            <!-- Card form will be created here -->
                                        </div>
                                        <div class="error-message" id="cardError"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Net 30 Terms (Business customers only) -->
                            <div id="net30PaymentForm" style="display: none;">
                                <div class="alert alert-info mt-3">
                                    <h6><i class="fas fa-info-circle"></i> Net 30 Payment Terms</h6>
                                    <p class="mb-2">Available for approved business customers with established credit.</p>
                                    <ul class="mb-2">
                                        <li>Minimum order: $500</li>
                                        <li>Credit approval required</li>
                                        <li>Payment due within 30 days</li>
                                        <li>2% discount for payments within 10 days</li>
                                    </ul>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="acceptNet30Terms">
                                        <label class="form-check-label" for="acceptNet30Terms">
                                            I accept Net 30 payment terms and authorize credit check
                                        </label>
                                    </div>
                                </div>
                                <div class="under-construction mt-2">
                                    <i class="fas fa-wrench"></i> Net 30 terms require credit approval - call (801) 712-5663
                                </div>
                            </div>

                            <!-- ACH Transfer -->
                            <div id="achPaymentForm" style="display: none;">
                                <div class="alert alert-info mt-3">
                                    <h6><i class="fas fa-info-circle"></i> ACH Bank Transfer</h6>
                                    <p class="mb-2">Direct bank transfer for large orders. Processing time: 1-3 business days.</p>
                                    <div class="row g-3 mt-2">
                                        <div class="col-md-6">
                                            <label for="bankRoutingNumber" class="form-label">Routing Number</label>
                                            <input type="text" class="form-control" id="bankRoutingNumber" placeholder="123456789" maxlength="9">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bankAccountNumber" class="form-label">Account Number</label>
                                            <input type="text" class="form-control" id="bankAccountNumber" placeholder="Account Number">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bankAccountType" class="form-label">Account Type</label>
                                            <select class="form-select" id="bankAccountType">
                                                <option value="">Select type</option>
                                                <option value="checking">Checking</option>
                                                <option value="savings">Savings</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bankName" class="form-label">Bank Name</label>
                                            <input type="text" class="form-control" id="bankName" placeholder="Bank Name">
                                        </div>
                                    </div>
                                </div>
                                <div class="under-construction mt-2">
                                    <i class="fas fa-wrench"></i> ACH processing under construction - call (801) 712-5663
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="form-section">
                            <h5><i class="fas fa-gavel text-primary me-2"></i>Terms & Conditions</h5>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="agreeTerms" name="agreeTerms" required>
                                <label class="form-check-label" for="agreeTerms">
                                    I agree to the <a href="../legal-information.html" target="_blank">Terms of Service</a> and <a href="../legal-information.html" target="_blank">Privacy Policy</a> *
                                </label>
                                <div class="error-message" id="agreeTermsError"></div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="agreeRefund" name="agreeRefund" required>
                                <label class="form-check-label" for="agreeRefund">
                                    I understand the refund and return policy *
                                </label>
                                <div class="error-message" id="agreeRefundError"></div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="subscribeNewsletter" name="subscribeNewsletter">
                                <label class="form-check-label" for="subscribeNewsletter">
                                    Subscribe to our newsletter for product updates and special offers
                                </label>
                            </div>
                        </div>

                    </div>

                    <!-- Right Column - Order Summary -->
                    <div class="col-lg-4">
                        <div class="order-summary p-3">
                            <h5 class="fw-bold mb-3">
                                <i class="fas fa-receipt text-primary me-2"></i>Order Summary
                            </h5>
                            
                            <!-- Order Items -->
                            <div id="orderItems">
                                <!-- Order items will be populated here -->
                            </div>
                            
                            <!-- Promo Code -->
                            <div class="mt-3">
                                <div class="input-group">
                                    <input type="text" id="promoCode" class="form-control" placeholder="Enter promo code">
                                    <button class="btn btn-outline-primary" type="button" onclick="applyPromoCode()">Apply</button>
                                </div>
                                <div class="under-construction mt-2">
                                    <i class="fas fa-wrench"></i> Promo code system under construction
                                </div>
                            </div>
                            
                            <!-- Summary Totals -->
                            <div class="mt-3">
                                <div class="summary-row">
                                    <span>Subtotal:</span>
                                    <span id="subtotal">$0.00</span>
                                </div>
                                
                                <div class="summary-row" id="volumeDiscountRow" style="display: none;">
                                    <span>Volume Discount:</span>
                                    <span id="volumeDiscount" class="text-success">-$0.00</span>
                                </div>
                                
                                <div class="summary-row" id="wholesaleDiscountRow" style="display: none;">
                                    <span>Wholesale Pricing:</span>
                                    <span id="wholesaleDiscount" class="text-primary">-$0.00</span>
                                </div>
                                
                                <div class="summary-row" id="promoDiscountRow" style="display: none;">
                                    <span>Promo Code:</span>
                                    <span id="promoDiscount" class="text-success">-$0.00</span>
                                </div>
                                
                                <div class="summary-row">
                                    <span>Shipping:</span>
                                    <span id="shipping" class="text-success fw-bold">FREE</span>
                                </div>
                                
                                <div class="summary-row">
                                    <span>Tax (UT 7.75%):</span>
                                    <span id="tax">$0.00</span>
                                </div>
                                
                                <div class="summary-row total-row">
                                    <span>Total:</span>
                                    <span id="total">$0.00</span>
                                </div>
                            </div>
                            
                            <!-- Estimated Delivery -->
                            <div class="mt-3 p-2 bg-light rounded">
                                <h6 class="fw-bold mb-1">
                                    <i class="fas fa-truck text-primary me-2"></i>Estimated Delivery
                                </h6>
                                <p class="mb-0 text-muted" id="estimatedDelivery">2-3 business days</p>
                            </div>
                            
                            <!-- Place Order Button -->
                            <div class="d-grid gap-2 mt-3">
                                <button type="submit" class="btn btn-primary btn-lg" id="placeOrderBtn">
                                    <i class="fas fa-lock me-2"></i>Place Secure Order
                                    <div class="loading-spinner ms-2" id="orderSpinner"></div>
                                </button>
                                
                                <button type="button" class="btn btn-outline-secondary" onclick="window.location.href='cart.html'">
                                    <i class="fas fa-arrow-left me-2"></i>Back to Cart
                                </button>
                            </div>
                        </div>
                        
                        <!-- Trust Signals -->
                        <div class="trust-signals mt-3">
                            <h6>Your Information is Protected</h6>
                            <div class="trust-badges">
                                <div class="trust-badge">
                                    <i class="fas fa-shield-alt text-success"></i>
                                    <span>SSL Secured</span>
                                </div>
                                <div class="trust-badge">
                                    <i class="fas fa-lock text-primary"></i>
                                    <span>PCI Compliant</span>
                                </div>
                                <div class="trust-badge">
                                    <i class="fas fa-check-circle text-success"></i>
                                    <span>Verified Secure</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Support -->
                        <div class="text-center mt-3">
                            <p class="text-muted mb-2">Need help with your order?</p>
                            <div class="d-grid gap-2">
                                <a href="tel:+18017125663" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-phone me-2"></i>Call (801) 712-5663
                                </a>
                                <a href="mailto:info@organichyposolutions.com" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-envelope me-2"></i>Email Support
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <h5>üåø Organic HypoSolutions</h5>
                    <p>Utah's premier USDA Certified Organic HOCl sanitization services</p>
                    <p><small>Utah Business License #14565171-0160 | EPA Registration #97801-1</small></p>
                </div>
                <div class="col-md-4 text-center">
                    <h6>Secure Shopping</h6>
                    <p>Your payment information is protected with bank-level security.</p>
                    <div class="d-flex justify-content-center gap-2">
                        <span class="badge bg-success">SSL Secured</span>
                        <span class="badge bg-primary">PCI Compliant</span>
                        <span class="badge bg-info">Stripe Protected</span>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <p>üìû (801) 712-5663 | ‚úâÔ∏è ohshocl@gmail.com</p>
                    <div class="mb-2">
                        <a href="../legal-information.html" class="text-white text-decoration-none me-3">Legal Information</a>
                        <a href="../science-certifications.html" class="text-white text-decoration-none">Certifications</a>
                    </div>
                    <p><small>&copy; 2025 Organic HypoSolutions. All rights reserved.</small></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HEKE217WEY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-HEKE217WEY');
    </script>

    <!-- Checkout JavaScript -->
    <script>
        // Product Database (matching cart.html)
        const productDatabase = {
            '3oz-multi-use': {
                id: '3oz-multi-use',
                name: '3oz Multi-Use Disinfectant',
                category: 'Health & Beauty',
                price: 13.99,
                wholesalePrice: 8.99,
                image: 'https://via.placeholder.com/80x80?text=3oz',
                description: 'Perfect for wound care, skincare, travel sanitization',
                isPremium: false,
                margin: 35.2
            },
            '8oz-hc-pure': {
                id: '8oz-hc-pure',
                name: '8oz HC-Pure Skin Health Mist',
                category: 'Health & Beauty',
                price: 19.99,
                wholesalePrice: 12.99,
                image: 'https://via.placeholder.com/80x80?text=8oz',
                description: 'Professional skincare and beauty applications',
                isPremium: true,
                margin: 42.1
            },
            '32oz-ready-to-use': {
                id: '32oz-ready-to-use',
                name: '32oz Multi-Use Cleaner Ready to Use',
                category: 'Home & Garden',
                price: 32.99,
                wholesalePrice: 22.99,
                image: 'https://via.placeholder.com/80x80?text=32oz',
                description: 'Perfect for household cleaning and disinfection',
                isPremium: false,
                margin: 38.5
            },
            '32oz-pet-cleaner': {
                id: '32oz-pet-cleaner',
                name: '32oz Pet Cleaner and Deodorizer',
                category: 'Pet Care',
                price: 32.99,
                wholesalePrice: 22.99,
                image: 'https://via.placeholder.com/80x80?text=Pet',
                description: 'Safe for pets, eliminates odors naturally',
                isPremium: false,
                margin: 38.5
            },
            '1gal-ready-to-use': {
                id: '1gal-ready-to-use',
                name: '1 Gallon Ready to Use',
                category: 'Home & Garden',
                price: 69.99,
                wholesalePrice: 52.99,
                image: 'https://via.placeholder.com/80x80?text=1GAL',
                description: 'Bulk solution for large applications',
                isPremium: true,
                margin: 45.89
            },
            '1gal-500ppm': {
                id: '1gal-500ppm',
                name: '1 Gallon 500ppm Organic',
                category: 'Industrial',
                price: 89.99,
                wholesalePrice: 69.99,
                image: 'https://via.placeholder.com/80x80?text=500ppm',
                description: 'High-concentration for professional use',
                isPremium: true,
                margin: 45.89
            },
            'healing-serum': {
                id: 'healing-serum',
                name: 'HC-Pure Healing Skin Serum',
                category: 'Health & Beauty',
                price: 39.99,
                wholesalePrice: 24.99,
                image: 'https://via.placeholder.com/80x80?text=Serum',
                description: 'Advanced healing formula for skin repair',
                isPremium: true,
                margin: 44.2
            },
            'diaper-rash-gel': {
                id: 'diaper-rash-gel',
                name: '100ml Diaper Rash Gel',
                category: 'Baby Care',
                price: 39.99,
                wholesalePrice: 24.99,
                image: 'https://via.placeholder.com/80x80?text=Baby',
                description: 'Gentle, effective relief for babies',
                isPremium: true,
                margin: 44.2
            },
            'laundry-booster': {
                id: 'laundry-booster',
                name: 'Laundry Booster & Sanitizer',
                category: 'Industrial',
                price: 24.99,
                wholesalePrice: 16.99,
                image: 'https://via.placeholder.com/80x80?text=Laundry',
                description: 'Boost cleaning power in your wash',
                isPremium: true,
                margin: 45.89
            }
        };

        // Volume Discount Tiers
        const volumeDiscounts = {
            5: 0.05,   // 5% discount for 5+ units
            10: 0.10,  // 10% discount for 10+ units
            25: 0.15,  // 15% discount for 25+ units
            50: 0.20   // 20% discount for 50+ units
        };

        // Checkout state management
        let cart = JSON.parse(localStorage.getItem('ohsCart') || '[]');
        let isWholesaleCustomer = localStorage.getItem('ohsWholesaleCustomer') === 'true';
        let stripe = null;
        let cardElement = null;
        let paymentMethod = 'card';

        // Tax rates and thresholds
        const TAX_RATE = 0.0775; // Utah sales tax 7.75%
        const FREE_SHIPPING_THRESHOLD = 50;
        const WHOLESALE_MINIMUM = 100;
        const NET30_MINIMUM = 500;

        // Initialize checkout on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeCheckout();
            loadOrderSummary();
            setupFormValidation();
            setupEventListeners();
            
            // Initialize payment method selection
            selectPaymentMethod('card'); // Default to card payment
            
            // Check if cart is empty
            if (cart.length === 0) {
                alert('Your cart is empty. Redirecting to products page.');
                window.location.href = '../products.html';
            }
        });

        function initializeCheckout() {
            // Initialize Stripe (commented out for now - will work without actual key)
            try {
                // stripe = Stripe('pk_test_51234567890123456789012345678901234567890123456789012345678901234'); // Replace with your actual key
                
                // Create card element (simulate for now)
                // const elements = stripe.elements();
                // cardElement = elements.create('card', {
                //     style: {
                //         base: {
                //             fontSize: '16px',
                //             color: '#424770',
                //             '::placeholder': {
                //                 color: '#aab7c4',
                //             },
                //         },
                //     },
                // });
                
                // cardElement.mount('#cardElement');
                
                // For now, create a simple card input form
                createCardInputForm();
                
            } catch (error) {
                console.log('Stripe not configured, using placeholder form');
                createCardInputForm();
            }
            
            // Show business section for wholesale customers
            if (isWholesaleCustomer) {
                document.getElementById('businessSection').style.display = 'block';
                document.querySelectorAll('#businessSection input[required]').forEach(input => {
                    input.setAttribute('required', 'required');
                });
            }
        }

        function createCardInputForm() {
            // Create placeholder card input form
            const cardElementDiv = document.getElementById('cardElement');
            cardElementDiv.innerHTML = `
                <div class="row g-2">
                    <div class="col-12">
                        <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                        <label class="form-label">Card Number</label>
                    </div>
                    <div class="col-6">
                        <input type="text" class="form-control" id="cardExpiry" placeholder="MM/YY" maxlength="5" required>
                        <label class="form-label">Expiry Date</label>
                    </div>
                    <div class="col-6">
                        <input type="text" class="form-control" id="cardCvc" placeholder="123" maxlength="4" required>
                        <label class="form-label">CVC</label>
                    </div>
                    <div class="col-12">
                        <input type="text" class="form-control" id="cardName" placeholder="Name on Card" required>
                        <label class="form-label">Cardholder Name</label>
                    </div>
                </div>
            `;
            
            // Add input formatting
            setupCardInputFormatting();
        }

        function setupCardInputFormatting() {
            // Card number formatting
            document.getElementById('cardNumber').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
                let formattedValue = '';
                
                for (let i = 0; i < value.length; i++) {
                    if (i > 0 && i % 4 === 0) {
                        formattedValue += ' ';
                    }
                    formattedValue += value[i];
                }
                
                e.target.value = formattedValue;
            });
            
            // Expiry date formatting
            document.getElementById('cardExpiry').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
            });
            
            // CVC formatting
            document.getElementById('cardCvc').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '');
            });
        }

        function setupEventListeners() {
            // Same as billing checkbox
            document.getElementById('sameAsBinding').addEventListener('change', function() {
                const shippingFields = document.getElementById('shippingAddressFields');
                shippingFields.style.display = this.checked ? 'none' : 'block';
            });

            // Form submission
            document.getElementById('checkoutForm').addEventListener('submit', handleFormSubmit);

            // Real-time validation
            document.querySelectorAll('input[required]').forEach(input => {
                input.addEventListener('blur', validateField);
            });
        }

        function loadOrderSummary() {
            const orderItemsContainer = document.getElementById('orderItems');
            orderItemsContainer.innerHTML = '';
            
            if (cart.length === 0) {
                orderItemsContainer.innerHTML = '<p class="text-muted">No items in cart</p>';
                return;
            }
            
            cart.forEach(item => {
                const product = productDatabase[item.productId];
                if (!product) return;
                
                const currentPrice = isWholesaleCustomer ? product.wholesalePrice : product.price;
                const volumeDiscount = calculateVolumeDiscount(item.quantity);
                const discountedPrice = currentPrice * (1 - volumeDiscount);
                const totalPrice = discountedPrice * item.quantity;
                
                const orderItemHTML = `
                    <div class="order-item">
                        <div class="row align-items-center">
                            <div class="col-3">
                                <img src="${product.image}" alt="${product.name}" class="product-image">
                            </div>
                            <div class="col-6">
                                <h6 class="fw-bold mb-1">${product.name}</h6>
                                <p class="text-muted small mb-1">Qty: ${item.quantity}</p>
                                ${volumeDiscount > 0 ? `<span class="badge bg-success">${Math.round(volumeDiscount * 100)}% Off</span>` : ''}
                                ${product.isPremium ? '<span class="badge bg-warning">Premium</span>' : ''}
                            </div>
                            <div class="col-3 text-end">
                                <div class="fw-bold">${totalPrice.toFixed(2)}</div>
                                ${volumeDiscount > 0 ? `<small class="text-muted text-decoration-line-through">$${(currentPrice * item.quantity).toFixed(2)}</small>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                orderItemsContainer.innerHTML += orderItemHTML;
            });
            
            updateOrderTotals();
        }

        function calculateVolumeDiscount(quantity) {
            for (const [minQty, discount] of Object.entries(volumeDiscounts).reverse()) {
                if (quantity >= parseInt(minQty)) {
                    return discount;
                }
            }
            return 0;
        }

        function updateOrderTotals() {
            let subtotal = 0;
            let totalVolumeDiscount = 0;
            let totalWholesaleDiscount = 0;
            
            cart.forEach(item => {
                const product = productDatabase[item.productId];
                if (!product) return;
                
                const retailPrice = product.price;
                const currentPrice = isWholesaleCustomer ? product.wholesalePrice : retailPrice;
                const volumeDiscount = calculateVolumeDiscount(item.quantity);
                const discountedPrice = currentPrice * (1 - volumeDiscount);
                const itemTotal = discountedPrice * item.quantity;
                
                subtotal += itemTotal;
                
                if (volumeDiscount > 0) {
                    totalVolumeDiscount += (currentPrice - discountedPrice) * item.quantity;
                }
                
                if (isWholesaleCustomer) {
                    totalWholesaleDiscount += (retailPrice - product.wholesalePrice) * item.quantity;
                }
            });
            
            const tax = subtotal * TAX_RATE;
            const total = subtotal + tax;
            
            // Update display
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
            
            // Volume discount display
            if (totalVolumeDiscount > 0) {
                document.getElementById('volumeDiscountRow').style.display = 'flex';
                document.getElementById('volumeDiscount').textContent = `-$${totalVolumeDiscount.toFixed(2)}`;
            }
            
            // Wholesale discount display
            if (totalWholesaleDiscount > 0) {
                document.getElementById('wholesaleDiscountRow').style.display = 'flex';
                document.getElementById('wholesaleDiscount').textContent = `-$${totalWholesaleDiscount.toFixed(2)}`;
            }
            
            // Update estimated delivery
            updateEstimatedDelivery();
        }

        function updateEstimatedDelivery() {
            const estimatedDelivery = document.getElementById('estimatedDelivery');
            const today = new Date();
            const deliveryDate = new Date(today);
            deliveryDate.setDate(today.getDate() + 3); // 3 business days
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            estimatedDelivery.textContent = `By ${deliveryDate.toLocaleDateString('en-US', options)}`;
        }

        function selectPaymentMethod(method) {
            console.log('Selecting payment method:', method); // Debug log
            paymentMethod = method;
            
            // Update UI - remove active class from all payment methods
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('active');
            });
            
            // Add active class to selected method
            const selectedMethod = document.querySelector(`[data-method="${method}"]`);
            if (selectedMethod) {
                selectedMethod.classList.add('active');
            }
            
            // Show/hide payment forms
            document.getElementById('cardPaymentForm').style.display = method === 'card' ? 'block' : 'none';
            document.getElementById('net30PaymentForm').style.display = method === 'net30' ? 'block' : 'none';
            document.getElementById('achPaymentForm').style.display = method === 'ach' ? 'block' : 'none';
            
            // Update order button text
            const orderBtn = document.getElementById('placeOrderBtn');
            const spinner = document.getElementById('orderSpinner');
            
            switch(method) {
                case 'card':
                    orderBtn.innerHTML = '<i class="fas fa-lock me-2"></i>Place Secure Order <div class="loading-spinner ms-2" id="orderSpinner" style="display: none;"></div>';
                    break;
                case 'net30':
                    orderBtn.innerHTML = '<i class="fas fa-file-invoice me-2"></i>Submit Net 30 Order <div class="loading-spinner ms-2" id="orderSpinner" style="display: none;"></div>';
                    break;
                case 'ach':
                    orderBtn.innerHTML = '<i class="fas fa-university me-2"></i>Process ACH Payment <div class="loading-spinner ms-2" id="orderSpinner" style="display: none;"></div>';
                    break;
            }
            
            // Update form validation requirements
            updateFormValidation(method);
        }

        function updateFormValidation(method) {
            // Clear previous requirements
            document.querySelectorAll('#cardPaymentForm input, #net30PaymentForm input, #achPaymentForm input').forEach(input => {
                input.removeAttribute('required');
            });
            
            // Set requirements based on selected method
            if (method === 'card') {
                document.querySelectorAll('#cardPaymentForm input').forEach(input => {
                    input.setAttribute('required', 'required');
                });
            } else if (method === 'net30') {
                document.getElementById('acceptNet30Terms').setAttribute('required', 'required');
            } else if (method === 'ach') {
                document.querySelectorAll('#achPaymentForm input[type="text"], #achPaymentForm select').forEach(input => {
                    input.setAttribute('required', 'required');
                });
            }
        }

        function validateField(event) {
            const field = event.target;
            const errorElement = document.getElementById(field.id + 'Error');
            
            if (!field.checkValidity()) {
                if (errorElement) {
                    errorElement.textContent = field.validationMessage;
                    errorElement.style.display = 'block';
                }
                return false;
            } else {
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
                return true;
            }
        }

        function setupFormValidation() {
            // Email validation
            document.getElementById('email').addEventListener('blur', function() {
                const email = this.value;
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const errorElement = document.getElementById('emailError');
                const successElement = document.getElementById('emailSuccess');
                
                if (email && emailRegex.test(email)) {
                    errorElement.style.display = 'none';
                    successElement.style.display = 'block';
                    // Here you could add real-time email verification
                } else if (email) {
                    errorElement.textContent = 'Please enter a valid email address';
                    errorElement.style.display = 'block';
                    successElement.style.display = 'none';
                }
            });

            // Phone number formatting
            document.getElementById('phone').addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.length >= 6) {
                    value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 3) {
                    value = value.replace(/(\d{3})(\d{0,3})/, '($1) $2');
                }
                this.value = value;
            });

            // ZIP code validation
            document.getElementById('billingZip').addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '').slice(0, 5);
            });
        }

        async function handleFormSubmit(event) {
            event.preventDefault();
            
            // Validate form
            if (!validateForm()) {
                return;
            }
            
            // Show loading state
            const orderBtn = document.getElementById('placeOrderBtn');
            const spinner = document.getElementById('orderSpinner');
            orderBtn.disabled = true;
            spinner.style.display = 'inline-block';
            
            try {
                if (paymentMethod === 'card') {
                    await processCardPayment();
                } else if (paymentMethod === 'net30') {
                    await processNet30Order();
                } else if (paymentMethod === 'ach') {
                    await processACHPayment();
                }
            } catch (error) {
                console.error('Payment processing error:', error);
                alert('Payment processing failed. Please try again or contact support.');
            } finally {
                // Reset loading state
                orderBtn.disabled = false;
                spinner.style.display = 'none';
            }
        }

        function validateForm() {
            let isValid = true;
            
            // Check all required fields
            document.querySelectorAll('input[required], select[required]').forEach(field => {
                if (!field.checkValidity()) {
                    const errorElement = document.getElementById(field.id + 'Error');
                    if (errorElement) {
                        errorElement.textContent = field.validationMessage;
                        errorElement.style.display = 'block';
                    }
                    isValid = false;
                }
            });
            
            // Check terms agreement
            if (!document.getElementById('agreeTerms').checked) {
                document.getElementById('agreeTermsError').textContent = 'You must agree to the terms and conditions';
                document.getElementById('agreeTermsError').style.display = 'block';
                isValid = false;
            }
            
            if (!document.getElementById('agreeRefund').checked) {
                document.getElementById('agreeRefundError').textContent = 'You must acknowledge the refund policy';
                document.getElementById('agreeRefundError').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }

        async function processCardPayment() {
            // Create payment intent with Stripe
            const {token, error} = await stripe.createToken(cardElement);
            
            if (error) {
                document.getElementById('cardError').textContent = error.message;
                document.getElementById('cardError').style.display = 'block';
                return;
            }
            
            // For now, simulate payment processing
            await simulatePaymentProcessing();
            
            // Analytics tracking
            gtag('event', 'purchase', {
                'transaction_id': 'txn_' + Date.now(),
                'value': calculateOrderTotal(),
                'currency': 'USD',
                'items': cart.map(item => ({
                    'item_id': item.productId,
                    'item_name': productDatabase[item.productId].name,
                    'quantity': item.quantity,
                    'price': isWholesaleCustomer ? productDatabase[item.productId].wholesalePrice : productDatabase[item.productId].price
                }))
            });
            
            // Redirect to success page
            localStorage.setItem('ohsOrderData', JSON.stringify({
                orderNumber: 'ORD-' + Date.now(),
                items: cart,
                total: calculateOrderTotal(),
                paymentMethod: 'Credit Card',
                timestamp: new Date().toISOString()
            }));
            
            // Clear cart
            localStorage.removeItem('ohsCart');
            
            // Redirect to success page
            window.location.href = 'order-success.html';
        }

        async function processNet30Order() {
            // Validate minimum order amount
            const total = calculateOrderTotal();
            if (total < NET30_MINIMUM) {
                alert(`Net 30 terms require a minimum order of $${NET30_MINIMUM}. Current order: $${total.toFixed(2)}`);
                return;
            }
            
            // Simulate credit check
            await simulatePaymentProcessing();
            
            alert('Net 30 order submitted for credit approval. You will receive confirmation within 24 hours.');
            
            // For now, redirect to success page
            window.location.href = 'order-success.html';
        }

        async function processACHPayment() {
            // Simulate ACH processing
            await simulatePaymentProcessing();
            
            alert('ACH payment processing initiated. Processing time: 1-3 business days.');
            
            // For now, redirect to success page
            window.location.href = 'order-success.html';
        }

        function simulatePaymentProcessing() {
            return new Promise(resolve => {
                setTimeout(resolve, 2000); // Simulate 2 second processing time
            });
        }

        function calculateOrderTotal() {
            let subtotal = 0;
            
            cart.forEach(item => {
                const product = productDatabase[item.productId];
                if (!product) return;
                
                const currentPrice = isWholesaleCustomer ? product.wholesalePrice : product.price;
                const volumeDiscount = calculateVolumeDiscount(item.quantity);
                const discountedPrice = currentPrice * (1 - volumeDiscount);
                subtotal += discountedPrice * item.quantity;
            });
            
            const tax = subtotal * TAX_RATE;
            return subtotal + tax;
        }

        function applyPromoCode() {
            const promoCode = document.getElementById('promoCode').value.trim();
            
            if (!promoCode) {
                alert('Please enter a promo code.');
                return;
            }
            
            // Simulate promo code validation
            alert('Promo code functionality is under construction. Please call (801) 712-5663 for discount codes.');
            
            // TODO: Implement actual promo code validation
            // This would integrate with Stripe coupons or your own discount system
        }

        // Digital wallet functions
        function payWithApplePay() {
            alert('Apple Pay integration is under construction. Please use credit card payment or call (801) 712-5663.');
            // TODO: Implement Apple Pay with Stripe
        }

        function payWithGooglePay() {
            alert('Google Pay integration is under construction. Please use credit card payment or call (801) 712-5663.');
            // TODO: Implement Google Pay with Stripe
        }

        function payWithPayPal() {
            alert('PayPal integration is under construction. Please use credit card payment or call (801) 712-5663.');
            // TODO: Implement PayPal integration
        }

        // Address validation (placeholder for future implementation)
        function validateAddress(address) {
            // TODO: Integrate with address validation service (USPS, UPS, etc.)
            return true;
        }

        // Inventory verification (placeholder for future implementation)
        function verifyInventory() {
            // TODO: Real-time inventory check before payment
            return true;
        }

        // Fraud detection (placeholder for future implementation)
        function checkFraud(orderData) {
            // TODO: Integrate with Stripe Radar or other fraud detection
            return { riskScore: 'low', approved: true };
        }

        // Auto-fill address from ZIP code
        document.getElementById('billingZip').addEventListener('blur', function() {
            const zip = this.value;
            if (zip.length === 5) {
                // TODO: Implement ZIP code to city/state lookup
                // This could use a service like Zippopotam.us or SmartyStreets
            }
        });

        // Customer type detection
        function detectCustomerType() {
            // Check if business information is filled
            const companyName = document.getElementById('companyName').value;
            const businessType = document.getElementById('businessType').value;
            
            if (companyName || businessType) {
                isWholesaleCustomer = true;
                localStorage.setItem('ohsWholesaleCustomer', 'true');
                updateOrderTotals();
            }
        }

        // Real-time total updates
        document.addEventListener('input', function(e) {
            if (e.target.matches('#companyName, #businessType')) {
                detectCustomerType();
            }
        });

        // Handle back button to prevent form data loss
        window.addEventListener('beforeunload', function(e) {
            // Save form data to localStorage for recovery
            const formData = new FormData(document.getElementById('checkoutForm'));
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            localStorage.setItem('ohsCheckoutFormData', JSON.stringify(formObject));
        });

        // Restore form data on page load
        function restoreFormData() {
            const savedData = localStorage.getItem('ohsCheckoutFormData');
            if (savedData) {
                const formData = JSON.parse(savedData);
                Object.entries(formData).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = value;
                        if (element.type === 'checkbox') {
                            element.checked = value === 'on';
                        }
                    }
                });
            }
        }

        // Call restore function after DOM is loaded
        document.addEventListener('DOMContentLoaded', restoreFormData);

        // Clear saved form data after successful order
        function clearFormData() {
            localStorage.removeItem('ohsCheckoutFormData');
        }

        // Accessibility improvements
        document.addEventListener('keydown', function(e) {
            // Allow Enter key to submit form
            if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                document.getElementById('placeOrderBtn').click();
            }
        });

        // Progress indicator updates
        function updateProgressIndicator(step) {
            const steps = document.querySelectorAll('.step');
            steps.forEach((stepEl, index) => {
                if (index < step - 1) {
                    stepEl.classList.add('completed');
                    stepEl.classList.remove('active');
                } else if (index === step - 1) {
                    stepEl.classList.add('active');
                    stepEl.classList.remove('completed');
                } else {
                    stepEl.classList.remove('active', 'completed');
                }
            });
        }

        // Update progress as user fills form
        document.addEventListener('input', function() {
            const form = document.getElementById('checkoutForm');
            const totalFields = form.querySelectorAll('input[required], select[required]').length;
            const filledFields = Array.from(form.querySelectorAll('input[required], select[required]')).filter(field => field.value).length;
            
            const progressPercentage = (filledFields / totalFields) * 100;
            
            if (progressPercentage < 25) {
                updateProgressIndicator(2);
            } else if (progressPercentage < 75) {
                updateProgressIndicator(3);
            } else {
                updateProgressIndicator(4);
            }
        });

        // Enhanced error handling
        function showError(message, type = 'error') {
            const alertClass = type === 'error' ? 'alert-danger' : 'alert-warning';
            const alertHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // Insert at top of form
            const form = document.getElementById('checkoutForm');
            form.insertAdjacentHTML('afterbegin', alertHTML);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                const alert = form.querySelector('.alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }

        // Enhanced success handling
        function showSuccess(message) {
            const alertHTML = `
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            const form = document.getElementById('checkoutForm');
            form.insertAdjacentHTML('afterbegin', alertHTML);
        }

        // Network error handling
        function handleNetworkError(error) {
            console.error('Network error:', error);
            showError('Network error occurred. Please check your connection and try again.');
        }

        // Retry mechanism for failed requests
        async function retryRequest(requestFunction, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await requestFunction();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1))); // Exponential backoff
                }
            }
        }

        // Order summary expansion for mobile
        function toggleOrderSummary() {
            const orderSummary = document.querySelector('.order-summary');
            orderSummary.classList.toggle('expanded');
        }

        // Add mobile-specific enhancements
        if (window.innerWidth <= 768) {
            // Make order summary collapsible on mobile
            const orderSummaryHeader = document.querySelector('.order-summary h5');
            if (orderSummaryHeader) {
                orderSummaryHeader.style.cursor = 'pointer';
                orderSummaryHeader.addEventListener('click', toggleOrderSummary);
            }
        }

        // Performance monitoring
        function trackPerformance() {
            // Track page load time
            window.addEventListener('load', function() {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                gtag('event', 'page_load_time', {
                    'event_category': 'performance',
                    'event_label': 'checkout',
                    'value': loadTime
                });
            });
        }

        // Initialize performance tracking
        trackPerformance();

        // Security enhancements
        function enhanceSecurity() {
            // Disable right-click context menu on sensitive elements
            document.querySelectorAll('.stripe-element, #cardElement').forEach(element => {
                element.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                });
            });

            // Clear sensitive data on page unload
            window.addEventListener('beforeunload', function() {
                // Clear any sensitive form data
                if (cardElement) {
                    cardElement.clear();
                }
            });
        }

        // Initialize security enhancements
        enhanceSecurity();

        // Final initialization
        function finalizeInitialization() {
            // Set focus to first field
            document.getElementById('firstName').focus();
            
            // Initialize tooltips if any
            const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltips.forEach(tooltip => {
                new bootstrap.Tooltip(tooltip);
            });
        }

        // Run final initialization
        document.addEventListener('DOMContentLoaded', finalizeInitialization);
    </script>
</body>
</html>
